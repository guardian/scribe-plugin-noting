{"version":3,"file":"scribe-plugin-noting.min.js","mappings":"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","sources":["../scribe-plugin-noting.js"],"sourcesContent":["!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var n;\"undefined\"!=typeof window?n=window:\"undefined\"!=typeof global?n=global:\"undefined\"!=typeof self&&(n=self),n.scribePluginNoting=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\n},{}],2:[function(require,module,exports){\n/*!\n* vdom-virtualize\n* Copyright 2014 by Marcel Klehr <mklehr@gmx.net>\n*\n* (MIT LICENSE)\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in\n* all copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n* THE SOFTWARE.\n*/\nvar VNode = require(\"vtree/vnode\")\n  , VText = require(\"vtree/vtext\")\n\nmodule.exports = createVNode\n\nfunction createVNode(domNode, key) {\n  key = key || null // XXX: Leave out `key` for now... merely used for (re-)ordering\n\n  if(domNode.nodeType == 1) return createFromElement(domNode, key)\n  if(domNode.nodeType == 3) return createFromTextNode(domNode, key)\n  return\n}\n\ncreateVNode.fromHTML = function(html, key) {\n  var domNode = document.createElement('div'); // create container\n  domNode.innerHTML = html; // browser parses HTML into DOM tree\n  domNode = domNode.children[0] || domNode; // select first node in tree\n  return createVNode(domNode, key);\n};\n\nfunction createFromTextNode(tNode) {\n  return new VText(tNode.nodeValue)\n}\n\n\nfunction createFromElement(el) {\n  var tagName = el.tagName\n  , namespace = el.namespaceURI == 'http://www.w3.org/1999/xhtml'? null : el.namespaceURI\n  , properties = getElementProperties(el)\n  , children = []\n\n  for (var i = 0; i < el.childNodes.length; i++) {\n    children.push(createVNode(el.childNodes[i]/*, i*/))\n  }\n\n  return new VNode(tagName, properties, children, null, namespace)\n}\n\n\nfunction getElementProperties(el) {\n  var obj = {}\n\n  props.forEach(function(propName) {\n    if(!el[propName]) return\n\n    // Special case: style\n    // .style is a DOMStyleDeclaration, thus we need to iterate over all\n    // rules to create a hash of applied css properties.\n    //\n    // You can directly set a specific .style[prop] = value so patching with vdom\n    // is possible.\n    if(\"style\" == propName) {\n      var css = {}\n        , styleProp\n      for(var i=0; i<el.style; i++) {\n        styleProp = el.style[i]\n        css[styleProp] = el.style.getPropertyValue(styleProp) // XXX: add support for \"!important\" via getPropertyPriority()!\n      }\n\n      obj[propName] = css\n      return\n    }\n\n    // Special case: dataset\n    // we can iterate over .dataset with a simple for..in loop.\n    // The all-time foo with data-* attribs is the dash-snake to camelCase\n    // conversion.\n    // However, I'm not sure if this is compatible with h()\n    //\n    // .dataset properties are directly accessible as transparent getters/setters, so\n    // patching with vdom is possible.\n    if(\"dataset\" == propName) {\n      var data = {}\n      for(var p in el.dataset) {\n        data[p] = el.dataset[p]\n      }\n\n      obj[propName] = data\n      return\n    }\n    \n    // Special case: attributes\n    // some properties are only accessible via .attributes, so \n    // that's what we'd do, if vdom-create-element could handle this.\n    if(\"attributes\" == propName) return\n    \n\n    // default: just copy the property\n    obj[propName] = el[propName]\n    return\n  })\n\n  return obj\n}\n\n/**\n * DOMNode property white list\n * Taken from https://github.com/Raynos/react/blob/dom-property-config/src/browser/ui/dom/DefaultDOMPropertyConfig.js\n */\nvar props =\n\nmodule.exports.properties = [\n \"accept\"\n,\"accessKey\"\n,\"action\"\n,\"alt\"\n,\"async\"\n,\"autoComplete\"\n,\"autoPlay\"\n,\"cellPadding\"\n,\"cellSpacing\"\n,\"checked\"\n,\"className\"\n,\"colSpan\"\n,\"content\"\n,\"contentEditable\"\n,\"controls\"\n,\"crossOrigin\"\n,\"data\"\n,\"dataset\"\n,\"defer\"\n,\"dir\"\n,\"download\"\n,\"draggable\"\n,\"encType\"\n,\"formNoValidate\"\n,\"href\"\n,\"hrefLang\"\n,\"htmlFor\"\n,\"httpEquiv\"\n,\"icon\"\n,\"id\"\n,\"label\"\n,\"lang\"\n,\"list\"\n,\"loop\"\n,\"max\"\n,\"mediaGroup\"\n,\"method\"\n,\"min\"\n,\"multiple\"\n,\"muted\"\n,\"name\"\n,\"noValidate\"\n,\"pattern\"\n,\"placeholder\"\n,\"poster\"\n,\"preload\"\n,\"radioGroup\"\n,\"readOnly\"\n,\"rel\"\n,\"required\"\n,\"rowSpan\"\n,\"sandbox\"\n,\"scope\"\n,\"scrollLeft\"\n,\"scrolling\"\n,\"scrollTop\"\n,\"selected\"\n,\"span\"\n,\"spellCheck\"\n,\"src\"\n,\"srcDoc\"\n,\"srcSet\"\n,\"start\"\n,\"step\"\n,\"style\"\n,\"tabIndex\"\n,\"target\"\n,\"title\"\n,\"type\"\n,\"value\"\n\n// Non-standard Properties\n,\"autoCapitalize\"\n,\"autoCorrect\"\n,\"property\"\n\n, \"attributes\"\n]\n\nvar attrs =\nmodule.exports.attrs = [\n \"allowFullScreen\"\n,\"allowTransparency\"\n,\"charSet\"\n,\"cols\"\n,\"contextMenu\"\n,\"dateTime\"\n,\"disabled\"\n,\"form\"\n,\"frameBorder\"\n,\"height\"\n,\"hidden\"\n,\"maxLength\"\n,\"role\"\n,\"rows\"\n,\"seamless\"\n,\"size\"\n,\"width\"\n,\"wmode\"\n\n// SVG Properties\n,\"cx\"\n,\"cy\"\n,\"d\"\n,\"dx\"\n,\"dy\"\n,\"fill\"\n,\"fx\"\n,\"fy\"\n,\"gradientTransform\"\n,\"gradientUnits\"\n,\"offset\"\n,\"points\"\n,\"r\"\n,\"rx\"\n,\"ry\"\n,\"spreadMethod\"\n,\"stopColor\"\n,\"stopOpacity\"\n,\"stroke\"\n,\"strokeLinecap\"\n,\"strokeWidth\"\n,\"textAnchor\"\n,\"transform\"\n,\"version\"\n,\"viewBox\"\n,\"x1\"\n,\"x2\"\n,\"x\"\n,\"y1\"\n,\"y2\"\n,\"y\"\n]\n\n},{\"vtree/vnode\":7,\"vtree/vtext\":8}],3:[function(require,module,exports){\nmodule.exports = isHook\n\nfunction isHook(hook) {\n    return hook && typeof hook.hook === \"function\" &&\n        !hook.hasOwnProperty(\"hook\")\n}\n\n},{}],4:[function(require,module,exports){\nvar version = require(\"./version\")\n\nmodule.exports = isVirtualNode\n\nfunction isVirtualNode(x) {\n    return x && x.type === \"VirtualNode\" && x.version === version\n}\n\n},{\"./version\":6}],5:[function(require,module,exports){\nmodule.exports = isWidget\n\nfunction isWidget(w) {\n    return w && w.type === \"Widget\"\n}\n\n},{}],6:[function(require,module,exports){\nmodule.exports = \"1\"\n\n},{}],7:[function(require,module,exports){\nvar version = require(\"./version\")\nvar isVNode = require(\"./is-vnode\")\nvar isWidget = require(\"./is-widget\")\nvar isVHook = require(\"./is-vhook\")\n\nmodule.exports = VirtualNode\n\nvar noProperties = {}\nvar noChildren = []\n\nfunction VirtualNode(tagName, properties, children, key, namespace) {\n    this.tagName = tagName\n    this.properties = properties || noProperties\n    this.children = children || noChildren\n    this.key = key != null ? String(key) : undefined\n    this.namespace = (typeof namespace === \"string\") ? namespace : null\n\n    var count = (children && children.length) || 0\n    var descendants = 0\n    var hasWidgets = false\n    var descendantHooks = false\n    var hooks\n\n    for (var propName in properties) {\n        if (properties.hasOwnProperty(propName)) {\n            var property = properties[propName]\n            if (isVHook(property)) {\n                if (!hooks) {\n                    hooks = {}\n                }\n\n                hooks[propName] = property\n            }\n        }\n    }\n\n    for (var i = 0; i < count; i++) {\n        var child = children[i]\n        if (isVNode(child)) {\n            descendants += child.count || 0\n\n            if (!hasWidgets && child.hasWidgets) {\n                hasWidgets = true\n            }\n\n            if (!descendantHooks && (child.hooks || child.descendantHooks)) {\n                descendantHooks = true\n            }\n        } else if (!hasWidgets && isWidget(child)) {\n            if (typeof child.destroy === \"function\") {\n                hasWidgets = true\n            }\n        }\n    }\n\n    this.count = count + descendants\n    this.hasWidgets = hasWidgets\n    this.hooks = hooks\n    this.descendantHooks = descendantHooks\n}\n\nVirtualNode.prototype.version = version\nVirtualNode.prototype.type = \"VirtualNode\"\n\n},{\"./is-vhook\":3,\"./is-vnode\":4,\"./is-widget\":5,\"./version\":6}],8:[function(require,module,exports){\nvar version = require(\"./version\")\n\nmodule.exports = VirtualText\n\nfunction VirtualText(text) {\n    this.text = String(text)\n}\n\nVirtualText.prototype.version = version\nVirtualText.prototype.type = \"VirtualText\"\n\n},{\"./version\":6}],9:[function(require,module,exports){\nvar diff = require(\"vtree/diff\")\n\nmodule.exports = diff\n\n},{\"vtree/diff\":42}],10:[function(require,module,exports){\nmodule.exports = isObject\n\nfunction isObject(x) {\n    return typeof x === \"object\" && x !== null\n}\n\n},{}],11:[function(require,module,exports){\nvar isObject = require(\"is-object\")\nvar isHook = require(\"vtree/is-vhook\")\n\nmodule.exports = applyProperties\n\nfunction applyProperties(node, props, previous) {\n    for (var propName in props) {\n        var propValue = props[propName]\n\n        if (propValue === undefined) {\n            removeProperty(node, props, previous, propName);\n        } else if (isHook(propValue)) {\n            propValue.hook(node,\n                propName,\n                previous ? previous[propName] : undefined)\n        } else {\n            if (isObject(propValue)) {\n                patchObject(node, props, previous, propName, propValue);\n            } else if (propValue !== undefined) {\n                node[propName] = propValue\n            }\n        }\n    }\n}\n\nfunction removeProperty(node, props, previous, propName) {\n    if (previous) {\n        var previousValue = previous[propName]\n\n        if (!isHook(previousValue)) {\n            if (propName === \"attributes\") {\n                for (var attrName in previousValue) {\n                    node.removeAttribute(attrName)\n                }\n            } else if (propName === \"style\") {\n                for (var i in previousValue) {\n                    node.style[i] = \"\"\n                }\n            } else if (typeof previousValue === \"string\") {\n                node[propName] = \"\"\n            } else {\n                node[propName] = null\n            }\n        }\n    }\n}\n\nfunction patchObject(node, props, previous, propName, propValue) {\n    var previousValue = previous ? previous[propName] : undefined\n\n    // Set attributes\n    if (propName === \"attributes\") {\n        for (var attrName in propValue) {\n            var attrValue = propValue[attrName]\n\n            if (attrValue === undefined) {\n                node.removeAttribute(attrName)\n            } else {\n                node.setAttribute(attrName, attrValue)\n            }\n        }\n\n        return\n    }\n\n    if(previousValue && isObject(previousValue) &&\n        getPrototype(previousValue) !== getPrototype(propValue)) {\n        node[propName] = propValue\n        return\n    }\n\n    if (!isObject(node[propName])) {\n        node[propName] = {}\n    }\n\n    var replacer = propName === \"style\" ? \"\" : undefined\n\n    for (var k in propValue) {\n        var value = propValue[k]\n        node[propName][k] = (value === undefined) ? replacer : value\n    }\n}\n\nfunction getPrototype(value) {\n    if (Object.getPrototypeOf) {\n        return Object.getPrototypeOf(value)\n    } else if (value.__proto__) {\n        return value.__proto__\n    } else if (value.constructor) {\n        return value.constructor.prototype\n    }\n}\n\n},{\"is-object\":10,\"vtree/is-vhook\":45}],12:[function(require,module,exports){\nvar document = require(\"global/document\")\n\nvar applyProperties = require(\"./apply-properties\")\n\nvar isVNode = require(\"vtree/is-vnode\")\nvar isVText = require(\"vtree/is-vtext\")\nvar isWidget = require(\"vtree/is-widget\")\nvar handleThunk = require(\"vtree/handle-thunk\")\n\nmodule.exports = createElement\n\nfunction createElement(vnode, opts) {\n    var doc = opts ? opts.document || document : document\n    var warn = opts ? opts.warn : null\n\n    vnode = handleThunk(vnode).a\n\n    if (isWidget(vnode)) {\n        return vnode.init()\n    } else if (isVText(vnode)) {\n        return doc.createTextNode(vnode.text)\n    } else if (!isVNode(vnode)) {\n        if (warn) {\n            warn(\"Item is not a valid virtual dom node\", vnode)\n        }\n        return null\n    }\n\n    var node = (vnode.namespace === null) ?\n        doc.createElement(vnode.tagName) :\n        doc.createElementNS(vnode.namespace, vnode.tagName)\n\n    var props = vnode.properties\n    applyProperties(node, props)\n\n    var children = vnode.children\n\n    for (var i = 0; i < children.length; i++) {\n        var childNode = createElement(children[i], opts)\n        if (childNode) {\n            node.appendChild(childNode)\n        }\n    }\n\n    return node\n}\n\n},{\"./apply-properties\":11,\"global/document\":14,\"vtree/handle-thunk\":43,\"vtree/is-vnode\":46,\"vtree/is-vtext\":47,\"vtree/is-widget\":48}],13:[function(require,module,exports){\n// Maps a virtual DOM tree onto a real DOM tree in an efficient manner.\n// We don't want to read all of the DOM nodes in the tree so we use\n// the in-order tree indexing to eliminate recursion down certain branches.\n// We only recurse into a DOM node if we know that it contains a child of\n// interest.\n\nvar noChild = {}\n\nmodule.exports = domIndex\n\nfunction domIndex(rootNode, tree, indices, nodes) {\n    if (!indices || indices.length === 0) {\n        return {}\n    } else {\n        indices.sort(ascending)\n        return recurse(rootNode, tree, indices, nodes, 0)\n    }\n}\n\nfunction recurse(rootNode, tree, indices, nodes, rootIndex) {\n    nodes = nodes || {}\n\n\n    if (rootNode) {\n        if (indexInRange(indices, rootIndex, rootIndex)) {\n            nodes[rootIndex] = rootNode\n        }\n\n        var vChildren = tree.children\n\n        if (vChildren) {\n\n            var childNodes = rootNode.childNodes\n\n            for (var i = 0; i < tree.children.length; i++) {\n                rootIndex += 1\n\n                var vChild = vChildren[i] || noChild\n                var nextIndex = rootIndex + (vChild.count || 0)\n\n                // skip recursion down the tree if there are no nodes down here\n                if (indexInRange(indices, rootIndex, nextIndex)) {\n                    recurse(childNodes[i], vChild, indices, nodes, rootIndex)\n                }\n\n                rootIndex = nextIndex\n            }\n        }\n    }\n\n    return nodes\n}\n\n// Binary search for an index in the interval [left, right]\nfunction indexInRange(indices, left, right) {\n    if (indices.length === 0) {\n        return false\n    }\n\n    var minIndex = 0\n    var maxIndex = indices.length - 1\n    var currentIndex\n    var currentItem\n\n    while (minIndex <= maxIndex) {\n        currentIndex = ((maxIndex + minIndex) / 2) >> 0\n        currentItem = indices[currentIndex]\n\n        if (minIndex === maxIndex) {\n            return currentItem >= left && currentItem <= right\n        } else if (currentItem < left) {\n            minIndex = currentIndex + 1\n        } else  if (currentItem > right) {\n            maxIndex = currentIndex - 1\n        } else {\n            return true\n        }\n    }\n\n    return false;\n}\n\nfunction ascending(a, b) {\n    return a > b ? 1 : -1\n}\n\n},{}],14:[function(require,module,exports){\n(function (global){\nvar topLevel = typeof global !== 'undefined' ? global :\n    typeof window !== 'undefined' ? window : {}\nvar minDoc = require('min-document');\n\nif (typeof document !== 'undefined') {\n    module.exports = document;\n} else {\n    var doccy = topLevel['__GLOBAL_DOCUMENT_CACHE@4'];\n\n    if (!doccy) {\n        doccy = topLevel['__GLOBAL_DOCUMENT_CACHE@4'] = minDoc;\n    }\n\n    module.exports = doccy;\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"min-document\":1}],15:[function(require,module,exports){\nvar applyProperties = require(\"./apply-properties\")\n\nvar isWidget = require(\"vtree/is-widget\")\nvar VPatch = require(\"vtree/vpatch\")\n\nvar render = require(\"./create-element\")\nvar updateWidget = require(\"./update-widget\")\n\nmodule.exports = applyPatch\n\nfunction applyPatch(vpatch, domNode, renderOptions) {\n    var type = vpatch.type\n    var vNode = vpatch.vNode\n    var patch = vpatch.patch\n\n    switch (type) {\n        case VPatch.REMOVE:\n            return removeNode(domNode, vNode)\n        case VPatch.INSERT:\n            return insertNode(domNode, patch, renderOptions)\n        case VPatch.VTEXT:\n            return stringPatch(domNode, vNode, patch, renderOptions)\n        case VPatch.WIDGET:\n            return widgetPatch(domNode, vNode, patch, renderOptions)\n        case VPatch.VNODE:\n            return vNodePatch(domNode, vNode, patch, renderOptions)\n        case VPatch.ORDER:\n            reorderChildren(domNode, patch)\n            return domNode\n        case VPatch.PROPS:\n            applyProperties(domNode, patch, vNode.properties)\n            return domNode\n        case VPatch.THUNK:\n            return replaceRoot(domNode,\n                renderOptions.patch(domNode, patch, renderOptions))\n        default:\n            return domNode\n    }\n}\n\nfunction removeNode(domNode, vNode) {\n    var parentNode = domNode.parentNode\n\n    if (parentNode) {\n        parentNode.removeChild(domNode)\n    }\n\n    destroyWidget(domNode, vNode);\n\n    return null\n}\n\nfunction insertNode(parentNode, vNode, renderOptions) {\n    var newNode = render(vNode, renderOptions)\n\n    if (parentNode) {\n        parentNode.appendChild(newNode)\n    }\n\n    return parentNode\n}\n\nfunction stringPatch(domNode, leftVNode, vText, renderOptions) {\n    var newNode\n\n    if (domNode.nodeType === 3) {\n        domNode.replaceData(0, domNode.length, vText.text)\n        newNode = domNode\n    } else {\n        var parentNode = domNode.parentNode\n        newNode = render(vText, renderOptions)\n\n        if (parentNode) {\n            parentNode.replaceChild(newNode, domNode)\n        }\n    }\n\n    destroyWidget(domNode, leftVNode)\n\n    return newNode\n}\n\nfunction widgetPatch(domNode, leftVNode, widget, renderOptions) {\n    if (updateWidget(leftVNode, widget)) {\n        return widget.update(leftVNode, domNode) || domNode\n    }\n\n    var parentNode = domNode.parentNode\n    var newWidget = render(widget, renderOptions)\n\n    if (parentNode) {\n        parentNode.replaceChild(newWidget, domNode)\n    }\n\n    destroyWidget(domNode, leftVNode)\n\n    return newWidget\n}\n\nfunction vNodePatch(domNode, leftVNode, vNode, renderOptions) {\n    var parentNode = domNode.parentNode\n    var newNode = render(vNode, renderOptions)\n\n    if (parentNode) {\n        parentNode.replaceChild(newNode, domNode)\n    }\n\n    destroyWidget(domNode, leftVNode)\n\n    return newNode\n}\n\nfunction destroyWidget(domNode, w) {\n    if (typeof w.destroy === \"function\" && isWidget(w)) {\n        w.destroy(domNode)\n    }\n}\n\nfunction reorderChildren(domNode, bIndex) {\n    var children = []\n    var childNodes = domNode.childNodes\n    var len = childNodes.length\n    var i\n    var reverseIndex = bIndex.reverse\n\n    for (i = 0; i < len; i++) {\n        children.push(domNode.childNodes[i])\n    }\n\n    var insertOffset = 0\n    var move\n    var node\n    var insertNode\n    for (i = 0; i < len; i++) {\n        move = bIndex[i]\n        if (move !== undefined && move !== i) {\n            // the element currently at this index will be moved later so increase the insert offset\n            if (reverseIndex[i] > i) {\n                insertOffset++\n            }\n\n            node = children[move]\n            insertNode = childNodes[i + insertOffset] || null\n            if (node !== insertNode) {\n                domNode.insertBefore(node, insertNode)\n            }\n\n            // the moved element came from the front of the array so reduce the insert offset\n            if (move < i) {\n                insertOffset--\n            }\n        }\n\n        // element at this index is scheduled to be removed so increase insert offset\n        if (i in bIndex.removes) {\n            insertOffset++\n        }\n    }\n}\n\nfunction replaceRoot(oldRoot, newRoot) {\n    if (oldRoot && newRoot && oldRoot !== newRoot && oldRoot.parentNode) {\n        console.log(oldRoot)\n        oldRoot.parentNode.replaceChild(newRoot, oldRoot)\n    }\n\n    return newRoot;\n}\n\n},{\"./apply-properties\":11,\"./create-element\":12,\"./update-widget\":17,\"vtree/is-widget\":48,\"vtree/vpatch\":52}],16:[function(require,module,exports){\nvar document = require(\"global/document\")\nvar isArray = require(\"x-is-array\")\n\nvar domIndex = require(\"./dom-index\")\nvar patchOp = require(\"./patch-op\")\nmodule.exports = patch\n\nfunction patch(rootNode, patches) {\n    return patchRecursive(rootNode, patches)\n}\n\nfunction patchRecursive(rootNode, patches, renderOptions) {\n    var indices = patchIndices(patches)\n\n    if (indices.length === 0) {\n        return rootNode\n    }\n\n    var index = domIndex(rootNode, patches.a, indices)\n    var ownerDocument = rootNode.ownerDocument\n\n    if (!renderOptions) {\n        renderOptions = { patch: patchRecursive }\n        if (ownerDocument !== document) {\n            renderOptions.document = ownerDocument\n        }\n    }\n\n    for (var i = 0; i < indices.length; i++) {\n        var nodeIndex = indices[i]\n        rootNode = applyPatch(rootNode,\n            index[nodeIndex],\n            patches[nodeIndex],\n            renderOptions)\n    }\n\n    return rootNode\n}\n\nfunction applyPatch(rootNode, domNode, patchList, renderOptions) {\n    if (!domNode) {\n        return rootNode\n    }\n\n    var newNode\n\n    if (isArray(patchList)) {\n        for (var i = 0; i < patchList.length; i++) {\n            newNode = patchOp(patchList[i], domNode, renderOptions)\n\n            if (domNode === rootNode) {\n                rootNode = newNode\n            }\n        }\n    } else {\n        newNode = patchOp(patchList, domNode, renderOptions)\n\n        if (domNode === rootNode) {\n            rootNode = newNode\n        }\n    }\n\n    return rootNode\n}\n\nfunction patchIndices(patches) {\n    var indices = []\n\n    for (var key in patches) {\n        if (key !== \"a\") {\n            indices.push(Number(key))\n        }\n    }\n\n    return indices\n}\n\n},{\"./dom-index\":13,\"./patch-op\":15,\"global/document\":14,\"x-is-array\":18}],17:[function(require,module,exports){\nvar isWidget = require(\"vtree/is-widget\")\n\nmodule.exports = updateWidget\n\nfunction updateWidget(a, b) {\n    if (isWidget(a) && isWidget(b)) {\n        if (\"name\" in a && \"name\" in b) {\n            return a.id === b.id\n        } else {\n            return a.init === b.init\n        }\n    }\n\n    return false\n}\n\n},{\"vtree/is-widget\":48}],18:[function(require,module,exports){\nvar nativeIsArray = Array.isArray\nvar toString = Object.prototype.toString\n\nmodule.exports = nativeIsArray || isArray\n\nfunction isArray(obj) {\n    return toString.call(obj) === \"[object Array]\"\n}\n\n},{}],19:[function(require,module,exports){\nvar patch = require(\"vdom/patch\")\n\nmodule.exports = patch\n\n},{\"vdom/patch\":16}],20:[function(require,module,exports){\nvar DataSet = require(\"data-set\")\n\nmodule.exports = DataSetHook;\n\nfunction DataSetHook(value) {\n    if (!(this instanceof DataSetHook)) {\n        return new DataSetHook(value);\n    }\n\n    this.value = value;\n}\n\nDataSetHook.prototype.hook = function (node, propertyName) {\n    var ds = DataSet(node)\n    var propName = propertyName.substr(5)\n\n    ds[propName] = this.value;\n};\n\n},{\"data-set\":25}],21:[function(require,module,exports){\nvar DataSet = require(\"data-set\")\n\nmodule.exports = DataSetHook;\n\nfunction DataSetHook(value) {\n    if (!(this instanceof DataSetHook)) {\n        return new DataSetHook(value);\n    }\n\n    this.value = value;\n}\n\nDataSetHook.prototype.hook = function (node, propertyName) {\n    var ds = DataSet(node)\n    var propName = propertyName.substr(3)\n\n    ds[propName] = this.value;\n};\n\n},{\"data-set\":25}],22:[function(require,module,exports){\nmodule.exports = SoftSetHook;\n\nfunction SoftSetHook(value) {\n    if (!(this instanceof SoftSetHook)) {\n        return new SoftSetHook(value);\n    }\n\n    this.value = value;\n}\n\nSoftSetHook.prototype.hook = function (node, propertyName) {\n    if (node[propertyName] !== this.value) {\n        node[propertyName] = this.value;\n    }\n};\n\n},{}],23:[function(require,module,exports){\nvar VNode = require(\"vtree/vnode.js\")\nvar VText = require(\"vtree/vtext.js\")\nvar isVNode = require(\"vtree/is-vnode\")\nvar isVText = require(\"vtree/is-vtext\")\nvar isWidget = require(\"vtree/is-widget\")\nvar isHook = require(\"vtree/is-vhook\")\nvar isVThunk = require(\"vtree/is-thunk\")\nvar TypedError = require(\"error/typed\")\n\nvar parseTag = require(\"./parse-tag.js\")\nvar softSetHook = require(\"./hooks/soft-set-hook.js\")\nvar dataSetHook = require(\"./hooks/data-set-hook.js\")\nvar evHook = require(\"./hooks/ev-hook.js\")\n\nvar UnexpectedVirtualElement = TypedError({\n    type: \"virtual-hyperscript.unexpected.virtual-element\",\n    message: \"Unexpected virtual child passed to h().\\n\" +\n        \"Expected a VNode / Vthunk / VWidget / string but:\\n\" +\n        \"got a {foreignObjectStr}.\\n\" +\n        \"The parent vnode is {parentVnodeStr}.\\n\" +\n        \"Suggested fix: change your `h(..., [ ... ])` callsite.\",\n    foreignObjectStr: null,\n    parentVnodeStr: null,\n    foreignObject: null,\n    parentVnode: null\n})\n\nmodule.exports = h\n\nfunction h(tagName, properties, children) {\n    var childNodes = []\n    var tag, props, key, namespace\n\n    if (!children && isChildren(properties)) {\n        children = properties\n        props = {}\n    }\n\n    props = props || properties || {}\n    tag = parseTag(tagName, props)\n\n    // support keys\n    if (\"key\" in props) {\n        key = props.key\n        props.key = undefined\n    }\n\n    // support namespace\n    if (\"namespace\" in props) {\n        namespace = props.namespace\n        props.namespace = undefined\n    }\n\n    // fix cursor bug\n    if (tag === \"input\" &&\n        \"value\" in props &&\n        props.value !== undefined &&\n        !isHook(props.value)\n    ) {\n        props.value = softSetHook(props.value)\n    }\n\n    var keys = Object.keys(props)\n    var propName, value\n    for (var j = 0; j < keys.length; j++) {\n        propName = keys[j]\n        value = props[propName]\n        if (isHook(value)) {\n            continue\n        }\n\n        // add data-foo support\n        if (propName.substr(0, 5) === \"data-\") {\n            props[propName] = dataSetHook(value)\n        }\n\n        // add ev-foo support\n        if (propName.substr(0, 3) === \"ev-\") {\n            props[propName] = evHook(value)\n        }\n    }\n\n    if (children !== undefined && children !== null) {\n        addChild(children, childNodes, tag, props)\n    }\n\n\n    var node = new VNode(tag, props, childNodes, key, namespace)\n\n    return node\n}\n\nfunction addChild(c, childNodes, tag, props) {\n    if (typeof c === \"string\") {\n        childNodes.push(new VText(c))\n    } else if (isChild(c)) {\n        childNodes.push(c)\n    } else if (Array.isArray(c)) {\n        for (var i = 0; i < c.length; i++) {\n            addChild(c[i], childNodes, tag, props)\n        }\n    } else if (c === null || c === undefined) {\n        return\n    } else {\n        throw UnexpectedVirtualElement({\n            foreignObjectStr: JSON.stringify(c),\n            foreignObject: c,\n            parentVnodeStr: JSON.stringify({\n                tagName: tag,\n                properties: props\n            }),\n            parentVnode: {\n                tagName: tag,\n                properties: props\n            }\n        })\n    }\n}\n\nfunction isChild(x) {\n    return isVNode(x) || isVText(x) || isWidget(x) || isVThunk(x)\n}\n\nfunction isChildren(x) {\n    return typeof x === \"string\" || Array.isArray(x) || isChild(x)\n}\n\n},{\"./hooks/data-set-hook.js\":20,\"./hooks/ev-hook.js\":21,\"./hooks/soft-set-hook.js\":22,\"./parse-tag.js\":41,\"error/typed\":32,\"vtree/is-thunk\":33,\"vtree/is-vhook\":34,\"vtree/is-vnode\":35,\"vtree/is-vtext\":36,\"vtree/is-widget\":37,\"vtree/vnode.js\":39,\"vtree/vtext.js\":40}],24:[function(require,module,exports){\nmodule.exports = createHash\n\nfunction createHash(elem) {\n    var attributes = elem.attributes\n    var hash = {}\n\n    if (attributes === null || attributes === undefined) {\n        return hash\n    }\n\n    for (var i = 0; i < attributes.length; i++) {\n        var attr = attributes[i]\n\n        if (attr.name.substr(0,5) !== \"data-\") {\n            continue\n        }\n\n        hash[attr.name.substr(5)] = attr.value\n    }\n\n    return hash\n}\n\n},{}],25:[function(require,module,exports){\nvar createStore = require(\"weakmap-shim/create-store\")\nvar Individual = require(\"individual\")\n\nvar createHash = require(\"./create-hash.js\")\n\nvar hashStore = Individual(\"__DATA_SET_WEAKMAP@3\", createStore())\n\nmodule.exports = DataSet\n\nfunction DataSet(elem) {\n    var store = hashStore(elem)\n\n    if (!store.hash) {\n        store.hash = createHash(elem)\n    }\n\n    return store.hash\n}\n\n},{\"./create-hash.js\":24,\"individual\":26,\"weakmap-shim/create-store\":27}],26:[function(require,module,exports){\n(function (global){\nvar root = typeof window !== 'undefined' ?\n    window : typeof global !== 'undefined' ?\n    global : {};\n\nmodule.exports = Individual\n\nfunction Individual(key, value) {\n    if (root[key]) {\n        return root[key]\n    }\n\n    Object.defineProperty(root, key, {\n        value: value\n        , configurable: true\n    })\n\n    return value\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],27:[function(require,module,exports){\nvar hiddenStore = require('./hidden-store.js');\n\nmodule.exports = createStore;\n\nfunction createStore() {\n    var key = {};\n\n    return function (obj) {\n        if (typeof obj !== 'object' || obj === null) {\n            throw new Error('Weakmap-shim: Key must be object')\n        }\n\n        var store = obj.valueOf(key);\n        return store && store.identity === key ?\n            store : hiddenStore(obj, key);\n    };\n}\n\n},{\"./hidden-store.js\":28}],28:[function(require,module,exports){\nmodule.exports = hiddenStore;\n\nfunction hiddenStore(obj, key) {\n    var store = { identity: key };\n    var valueOf = obj.valueOf;\n\n    Object.defineProperty(obj, \"valueOf\", {\n        value: function (value) {\n            return value !== key ?\n                valueOf.apply(this, arguments) : store;\n        },\n        writable: true\n    });\n\n    return store;\n}\n\n},{}],29:[function(require,module,exports){\nmodule.exports = function(obj) {\n    if (typeof obj === 'string') return camelCase(obj);\n    return walk(obj);\n};\n\nfunction walk (obj) {\n    if (!obj || typeof obj !== 'object') return obj;\n    if (isDate(obj) || isRegex(obj)) return obj;\n    if (isArray(obj)) return map(obj, walk);\n    return reduce(objectKeys(obj), function (acc, key) {\n        var camel = camelCase(key);\n        acc[camel] = walk(obj[key]);\n        return acc;\n    }, {});\n}\n\nfunction camelCase(str) {\n    return str.replace(/[_.-](\\w|$)/g, function (_,x) {\n        return x.toUpperCase();\n    });\n}\n\nvar isArray = Array.isArray || function (obj) {\n    return Object.prototype.toString.call(obj) === '[object Array]';\n};\n\nvar isDate = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object Date]';\n};\n\nvar isRegex = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object RegExp]';\n};\n\nvar has = Object.prototype.hasOwnProperty;\nvar objectKeys = Object.keys || function (obj) {\n    var keys = [];\n    for (var key in obj) {\n        if (has.call(obj, key)) keys.push(key);\n    }\n    return keys;\n};\n\nfunction map (xs, f) {\n    if (xs.map) return xs.map(f);\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        res.push(f(xs[i], i));\n    }\n    return res;\n}\n\nfunction reduce (xs, f, acc) {\n    if (xs.reduce) return xs.reduce(f, acc);\n    for (var i = 0; i < xs.length; i++) {\n        acc = f(acc, xs[i], i);\n    }\n    return acc;\n}\n\n},{}],30:[function(require,module,exports){\nvar nargs = /\\{([0-9a-zA-Z]+)\\}/g\nvar slice = Array.prototype.slice\n\nmodule.exports = template\n\nfunction template(string) {\n    var args\n\n    if (arguments.length === 2 && typeof arguments[1] === \"object\") {\n        args = arguments[1]\n    } else {\n        args = slice.call(arguments, 1)\n    }\n\n    if (!args || !args.hasOwnProperty) {\n        args = {}\n    }\n\n    return string.replace(nargs, function replaceArg(match, i, index) {\n        var result\n\n        if (string[index - 1] === \"{\" &&\n            string[index + match.length] === \"}\") {\n            return i\n        } else {\n            result = args.hasOwnProperty(i) ? args[i] : null\n            if (result === null || result === undefined) {\n                return \"\"\n            }\n\n            return result\n        }\n    })\n}\n\n},{}],31:[function(require,module,exports){\nmodule.exports = extend\n\nfunction extend(target) {\n    for (var i = 1; i < arguments.length; i++) {\n        var source = arguments[i]\n\n        for (var key in source) {\n            if (source.hasOwnProperty(key)) {\n                target[key] = source[key]\n            }\n        }\n    }\n\n    return target\n}\n\n},{}],32:[function(require,module,exports){\nvar camelize = require(\"camelize\")\nvar template = require(\"string-template\")\nvar extend = require(\"xtend/mutable\")\n\nmodule.exports = TypedError\n\nfunction TypedError(args) {\n    if (!args) {\n        throw new Error(\"args is required\");\n    }\n    if (!args.type) {\n        throw new Error(\"args.type is required\");\n    }\n    if (!args.message) {\n        throw new Error(\"args.message is required\");\n    }\n\n    var message = args.message\n\n    if (args.type && !args.name) {\n        var errorName = camelize(args.type) + \"Error\"\n        args.name = errorName[0].toUpperCase() + errorName.substr(1)\n    }\n\n    createError.type = args.type;\n    createError._name = args.name;\n\n    return createError;\n\n    function createError(opts) {\n        var result = new Error()\n\n        Object.defineProperty(result, \"type\", {\n            value: result.type,\n            enumerable: true,\n            writable: true,\n            configurable: true\n        })\n\n        var options = extend({}, args, opts)\n\n        extend(result, options)\n        result.message = template(message, options)\n\n        return result\n    }\n}\n\n\n},{\"camelize\":29,\"string-template\":30,\"xtend/mutable\":31}],33:[function(require,module,exports){\nmodule.exports = isThunk\r\n\r\nfunction isThunk(t) {\r\n    return t && t.type === \"Thunk\"\r\n}\r\n\n},{}],34:[function(require,module,exports){\nmodule.exports=require(3)\n},{\"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/is-vhook.js\":3}],35:[function(require,module,exports){\nmodule.exports=require(4)\n},{\"./version\":38,\"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/is-vnode.js\":4}],36:[function(require,module,exports){\nvar version = require(\"./version\")\n\nmodule.exports = isVirtualText\n\nfunction isVirtualText(x) {\n    return x && x.type === \"VirtualText\" && x.version === version\n}\n\n},{\"./version\":38}],37:[function(require,module,exports){\nmodule.exports=require(5)\n},{\"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/is-widget.js\":5}],38:[function(require,module,exports){\nmodule.exports=require(6)\n},{\"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/version.js\":6}],39:[function(require,module,exports){\nmodule.exports=require(7)\n},{\"./is-vhook\":34,\"./is-vnode\":35,\"./is-widget\":37,\"./version\":38,\"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/vnode.js\":7}],40:[function(require,module,exports){\nmodule.exports=require(8)\n},{\"./version\":38,\"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/vtext.js\":8}],41:[function(require,module,exports){\nvar classIdSplit = /([\\.#]?[a-zA-Z0-9_:-]+)/\nvar notClassId = /^\\.|#/\n\nmodule.exports = parseTag\n\nfunction parseTag(tag, props) {\n    if (!tag) {\n        return \"div\"\n    }\n\n    var noId = !(\"id\" in props)\n\n    var tagParts = tag.split(classIdSplit)\n    var tagName = null\n\n    if (notClassId.test(tagParts[1])) {\n        tagName = \"div\"\n    }\n\n    var classes, part, type, i\n    for (i = 0; i < tagParts.length; i++) {\n        part = tagParts[i]\n\n        if (!part) {\n            continue\n        }\n\n        type = part.charAt(0)\n\n        if (!tagName) {\n            tagName = part\n        } else if (type === \".\") {\n            classes = classes || []\n            classes.push(part.substring(1, part.length))\n        } else if (type === \"#\" && noId) {\n            props.id = part.substring(1, part.length)\n        }\n    }\n\n    if (classes) {\n        if (props.className) {\n            classes.push(props.className)\n        }\n\n        props.className = classes.join(\" \")\n    }\n\n    return tagName ? tagName.toLowerCase() : \"div\"\n}\n\n},{}],42:[function(require,module,exports){\nvar isArray = require(\"x-is-array\")\nvar isObject = require(\"is-object\")\n\nvar VPatch = require(\"./vpatch\")\nvar isVNode = require(\"./is-vnode\")\nvar isVText = require(\"./is-vtext\")\nvar isWidget = require(\"./is-widget\")\nvar isThunk = require(\"./is-thunk\")\nvar handleThunk = require(\"./handle-thunk\")\n\nmodule.exports = diff\n\nfunction diff(a, b) {\n    var patch = { a: a }\n    walk(a, b, patch, 0)\n    return patch\n}\n\nfunction walk(a, b, patch, index) {\n    if (a === b) {\n        if (isThunk(a) || isThunk(b)) {\n            thunks(a, b, patch, index)\n        } else {\n            hooks(b, patch, index)\n        }\n        return\n    }\n\n    var apply = patch[index]\n\n    if (b == null) {\n        apply = appendPatch(apply, new VPatch(VPatch.REMOVE, a, b))\n        destroyWidgets(a, patch, index)\n    } else if (isThunk(a) || isThunk(b)) {\n        thunks(a, b, patch, index)\n    } else if (isVNode(b)) {\n        if (isVNode(a)) {\n            if (a.tagName === b.tagName &&\n                a.namespace === b.namespace &&\n                a.key === b.key) {\n                var propsPatch = diffProps(a.properties, b.properties, b.hooks)\n                if (propsPatch) {\n                    apply = appendPatch(apply,\n                        new VPatch(VPatch.PROPS, a, propsPatch))\n                }\n            } else {\n                apply = appendPatch(apply, new VPatch(VPatch.VNODE, a, b))\n                destroyWidgets(a, patch, index)\n            }\n\n            apply = diffChildren(a, b, patch, apply, index)\n        } else {\n            apply = appendPatch(apply, new VPatch(VPatch.VNODE, a, b))\n            destroyWidgets(a, patch, index)\n        }\n    } else if (isVText(b)) {\n        if (!isVText(a)) {\n            apply = appendPatch(apply, new VPatch(VPatch.VTEXT, a, b))\n            destroyWidgets(a, patch, index)\n        } else if (a.text !== b.text) {\n            apply = appendPatch(apply, new VPatch(VPatch.VTEXT, a, b))\n        }\n    } else if (isWidget(b)) {\n        apply = appendPatch(apply, new VPatch(VPatch.WIDGET, a, b))\n\n        if (!isWidget(a)) {\n            destroyWidgets(a, patch, index)\n        }\n    }\n\n    if (apply) {\n        patch[index] = apply\n    }\n}\n\nfunction diffProps(a, b, hooks) {\n    var diff\n\n    for (var aKey in a) {\n        if (!(aKey in b)) {\n            diff = diff || {}\n            diff[aKey] = undefined\n        }\n\n        var aValue = a[aKey]\n        var bValue = b[aKey]\n\n        if (hooks && aKey in hooks) {\n            diff = diff || {}\n            diff[aKey] = bValue\n        } else {\n            if (isObject(aValue) && isObject(bValue)) {\n                if (getPrototype(bValue) !== getPrototype(aValue)) {\n                    diff = diff || {}\n                    diff[aKey] = bValue\n                } else {\n                    var objectDiff = diffProps(aValue, bValue)\n                    if (objectDiff) {\n                        diff = diff || {}\n                        diff[aKey] = objectDiff\n                    }\n                }\n            } else if (aValue !== bValue) {\n                diff = diff || {}\n                diff[aKey] = bValue\n            }\n        }\n    }\n\n    for (var bKey in b) {\n        if (!(bKey in a)) {\n            diff = diff || {}\n            diff[bKey] = b[bKey]\n        }\n    }\n\n    return diff\n}\n\nfunction getPrototype(value) {\n    if (Object.getPrototypeOf) {\n        return Object.getPrototypeOf(value)\n    } else if (value.__proto__) {\n        return value.__proto__\n    } else if (value.constructor) {\n        return value.constructor.prototype\n    }\n}\n\nfunction diffChildren(a, b, patch, apply, index) {\n    var aChildren = a.children\n    var bChildren = reorder(aChildren, b.children)\n\n    var aLen = aChildren.length\n    var bLen = bChildren.length\n    var len = aLen > bLen ? aLen : bLen\n\n    for (var i = 0; i < len; i++) {\n        var leftNode = aChildren[i]\n        var rightNode = bChildren[i]\n        index += 1\n\n        if (!leftNode) {\n            if (rightNode) {\n                // Excess nodes in b need to be added\n                apply = appendPatch(apply,\n                    new VPatch(VPatch.INSERT, null, rightNode))\n            }\n        } else if (!rightNode) {\n            if (leftNode) {\n                // Excess nodes in a need to be removed\n                patch[index] = new VPatch(VPatch.REMOVE, leftNode, null)\n                destroyWidgets(leftNode, patch, index)\n            }\n        } else {\n            walk(leftNode, rightNode, patch, index)\n        }\n\n        if (isVNode(leftNode) && leftNode.count) {\n            index += leftNode.count\n        }\n    }\n\n    if (bChildren.moves) {\n        // Reorder nodes last\n        apply = appendPatch(apply, new VPatch(VPatch.ORDER, a, bChildren.moves))\n    }\n\n    return apply\n}\n\n// Patch records for all destroyed widgets must be added because we need\n// a DOM node reference for the destroy function\nfunction destroyWidgets(vNode, patch, index) {\n    if (isWidget(vNode)) {\n        if (typeof vNode.destroy === \"function\") {\n            patch[index] = new VPatch(VPatch.REMOVE, vNode, null)\n        }\n    } else if (isVNode(vNode) && vNode.hasWidgets) {\n        var children = vNode.children\n        var len = children.length\n        for (var i = 0; i < len; i++) {\n            var child = children[i]\n            index += 1\n\n            destroyWidgets(child, patch, index)\n\n            if (isVNode(child) && child.count) {\n                index += child.count\n            }\n        }\n    }\n}\n\n// Create a sub-patch for thunks\nfunction thunks(a, b, patch, index) {\n    var nodes = handleThunk(a, b);\n    var thunkPatch = diff(nodes.a, nodes.b)\n    if (hasPatches(thunkPatch)) {\n        patch[index] = new VPatch(VPatch.THUNK, null, thunkPatch)\n    }\n}\n\nfunction hasPatches(patch) {\n    for (var index in patch) {\n        if (index !== \"a\") {\n            return true;\n        }\n    }\n\n    return false;\n}\n\n// Execute hooks when two nodes are identical\nfunction hooks(vNode, patch, index) {\n    if (isVNode(vNode)) {\n        if (vNode.hooks) {\n            patch[index] = new VPatch(VPatch.PROPS, vNode.hooks, vNode.hooks)\n        }\n\n        if (vNode.descendantHooks) {\n            var children = vNode.children\n            var len = children.length\n            for (var i = 0; i < len; i++) {\n                var child = children[i]\n                index += 1\n\n                hooks(child, patch, index)\n\n                if (isVNode(child) && child.count) {\n                    index += child.count\n                }\n            }\n        }\n    }\n}\n\n// List diff, naive left to right reordering\nfunction reorder(aChildren, bChildren) {\n\n    var bKeys = keyIndex(bChildren)\n\n    if (!bKeys) {\n        return bChildren\n    }\n\n    var aKeys = keyIndex(aChildren)\n\n    if (!aKeys) {\n        return bChildren\n    }\n\n    var bMatch = {}, aMatch = {}\n\n    for (var key in bKeys) {\n        bMatch[bKeys[key]] = aKeys[key]\n    }\n\n    for (var key in aKeys) {\n        aMatch[aKeys[key]] = bKeys[key]\n    }\n\n    var aLen = aChildren.length\n    var bLen = bChildren.length\n    var len = aLen > bLen ? aLen : bLen\n    var shuffle = []\n    var freeIndex = 0\n    var i = 0\n    var moveIndex = 0\n    var moves = {}\n    var removes = moves.removes = {}\n    var reverse = moves.reverse = {}\n    var hasMoves = false\n\n    while (freeIndex < len) {\n        var move = aMatch[i]\n        if (move !== undefined) {\n            shuffle[i] = bChildren[move]\n            if (move !== moveIndex) {\n                moves[move] = moveIndex\n                reverse[moveIndex] = move\n                hasMoves = true\n            }\n            moveIndex++\n        } else if (i in aMatch) {\n            shuffle[i] = undefined\n            removes[i] = moveIndex++\n            hasMoves = true\n        } else {\n            while (bMatch[freeIndex] !== undefined) {\n                freeIndex++\n            }\n\n            if (freeIndex < len) {\n                var freeChild = bChildren[freeIndex]\n                if (freeChild) {\n                    shuffle[i] = freeChild\n                    if (freeIndex !== moveIndex) {\n                        hasMoves = true\n                        moves[freeIndex] = moveIndex\n                        reverse[moveIndex] = freeIndex\n                    }\n                    moveIndex++\n                }\n                freeIndex++\n            }\n        }\n        i++\n    }\n\n    if (hasMoves) {\n        shuffle.moves = moves\n    }\n\n    return shuffle\n}\n\nfunction keyIndex(children) {\n    var i, keys\n\n    for (i = 0; i < children.length; i++) {\n        var child = children[i]\n\n        if (child.key !== undefined) {\n            keys = keys || {}\n            keys[child.key] = i\n        }\n    }\n\n    return keys\n}\n\nfunction appendPatch(apply, patch) {\n    if (apply) {\n        if (isArray(apply)) {\n            apply.push(patch)\n        } else {\n            apply = [apply, patch]\n        }\n\n        return apply\n    } else {\n        return patch\n    }\n}\n\n},{\"./handle-thunk\":43,\"./is-thunk\":44,\"./is-vnode\":46,\"./is-vtext\":47,\"./is-widget\":48,\"./vpatch\":52,\"is-object\":49,\"x-is-array\":50}],43:[function(require,module,exports){\nvar isVNode = require(\"./is-vnode\")\nvar isVText = require(\"./is-vtext\")\nvar isWidget = require(\"./is-widget\")\nvar isThunk = require(\"./is-thunk\")\n\nmodule.exports = handleThunk\n\nfunction handleThunk(a, b) {\n    var renderedA = a\n    var renderedB = b\n\n    if (isThunk(b)) {\n        renderedB = renderThunk(b, a)\n    }\n\n    if (isThunk(a)) {\n        renderedA = renderThunk(a, null)\n    }\n\n    return {\n        a: renderedA,\n        b: renderedB\n    }\n}\n\nfunction renderThunk(thunk, previous) {\n    var renderedThunk = thunk.vnode\n\n    if (!renderedThunk) {\n        renderedThunk = thunk.vnode = thunk.render(previous)\n    }\n\n    if (!(isVNode(renderedThunk) ||\n            isVText(renderedThunk) ||\n            isWidget(renderedThunk))) {\n        throw new Error(\"thunk did not return a valid node\");\n    }\n\n    return renderedThunk\n}\n\n},{\"./is-thunk\":44,\"./is-vnode\":46,\"./is-vtext\":47,\"./is-widget\":48}],44:[function(require,module,exports){\nmodule.exports=require(33)\n},{\"/Users/hgibson/git/scribe-plugin-noting/node_modules/virtual-hyperscript/node_modules/vtree/is-thunk.js\":33}],45:[function(require,module,exports){\nmodule.exports=require(3)\n},{\"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/is-vhook.js\":3}],46:[function(require,module,exports){\nmodule.exports=require(4)\n},{\"./version\":51,\"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/is-vnode.js\":4}],47:[function(require,module,exports){\nmodule.exports=require(36)\n},{\"./version\":51,\"/Users/hgibson/git/scribe-plugin-noting/node_modules/virtual-hyperscript/node_modules/vtree/is-vtext.js\":36}],48:[function(require,module,exports){\nmodule.exports=require(5)\n},{\"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/is-widget.js\":5}],49:[function(require,module,exports){\nmodule.exports=require(10)\n},{\"/Users/hgibson/git/scribe-plugin-noting/node_modules/virtual-dom/node_modules/is-object/index.js\":10}],50:[function(require,module,exports){\nmodule.exports=require(18)\n},{\"/Users/hgibson/git/scribe-plugin-noting/node_modules/virtual-dom/node_modules/x-is-array/index.js\":18}],51:[function(require,module,exports){\nmodule.exports=require(6)\n},{\"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/version.js\":6}],52:[function(require,module,exports){\nvar version = require(\"./version\")\n\nVirtualPatch.NONE = 0\nVirtualPatch.VTEXT = 1\nVirtualPatch.VNODE = 2\nVirtualPatch.WIDGET = 3\nVirtualPatch.PROPS = 4\nVirtualPatch.ORDER = 5\nVirtualPatch.INSERT = 6\nVirtualPatch.REMOVE = 7\nVirtualPatch.THUNK = 8\n\nmodule.exports = VirtualPatch\n\nfunction VirtualPatch(type, vNode, patch) {\n    this.type = Number(type)\n    this.vNode = vNode\n    this.patch = patch\n}\n\nVirtualPatch.prototype.version = version\nVirtualPatch.prototype.type = \"VirtualPatch\"\n\n},{\"./version\":51}],53:[function(require,module,exports){\nmodule.exports=require(8)\n},{\"./version\":51,\"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/vtext.js\":8}],54:[function(require,module,exports){\n// Scribe noting plugin\n\nvar notingCommands = require('./src/noting-commands');\n\n// config, example:\n// { user: 'Firstname Lastname',\n//   scribeInstancesSelector: '.ui-rich-text-editor__input' }\nmodule.exports = function(config) {\n  return function(scribe) {\n    notingCommands.init(scribe, config);\n  };\n};\n\n},{\"./src/noting-commands\":58}],55:[function(require,module,exports){\nvar vdom = require('./note-vdom');\n\nvar NOTE_CLASS_COLLAPSED = 'note--collapsed';\n\n// TODO: move this somewhere sharable\nfunction toggleClass(vNode, className, state) {\n  var classes = vNode.properties.className.split(' '),\n\n  existingIdx = classes.indexOf(className);\n\n  if (existingIdx !== -1) { // class exists\n    if (state !== true) {\n      classes.splice(existingIdx, 1);\n    }\n\n  } else if (state !== false) { // class doesn't exist\n    classes.push(className);\n  }\n\n  vNode.properties.className = classes.join(' ');\n}\n\n\n\nfunction toggleNotes(note, state) {\n  if (Array.isArray(note)) {\n    note.forEach(function(n) {\n      toggleClass(n.vNode, NOTE_CLASS_COLLAPSED, state);\n    });\n\n  } else {\n    toggleClass(note.vNode, NOTE_CLASS_COLLAPSED, state);\n  }\n}\n\n\nexports.collapseToggleSelectedNote = function collapseToggleSelectedNote(treeFocus) {\n  var selectedNote = vdom.findSelectedNote(treeFocus);\n\n  toggleNotes(selectedNote);\n\n};\n\nexports.collapseToggleAllNotes = function collapseToggleAllNotes(treeFocus, state) {\n  vdom.findAllNotes(treeFocus).forEach(function(notes) { toggleNotes(notes, state); });\n};\n\n},{\"./note-vdom\":57}],56:[function(require,module,exports){\n/**\n * Noting API\n *\n * Perform noting actions on a Virtual DOM\n */\n'use strict';\n\nvar h = require('virtual-hyperscript');\nvar isVText = require('vtree/is-vtext');\nvar VText = require('vtree/vtext');\nvar _ = require('lodash');\n\nvar NODE_NAME = 'GU-NOTE';\nvar TAG = 'gu-note';\n\nvar CLASS_NAME = 'note';\nvar DATA_NAME = 'data-note-edited-by';\nvar DATA_NAME_CAMEL = 'noteEditedBy';\nvar DATA_DATE = 'data-note-edited-date';\nvar DATA_DATE_CAMEL = 'noteEditedDate';\nvar NOTE_BARRIER_TAG = 'gu-note-barrier';\n\n\nvar vdom = require('./note-vdom');\n\n\n/**\n * Current User property must be set.\n * @type {String}\n */\nexports.user = 'unknown';\n\n/**\n* Noting: Create, remove, wrap etc.\n*/\n\n// Wrap in a note.\n// toWrap can be a vNode, DOM node or a string. One or an array with several.\nfunction wrapInNote(toWrap, dataAttrs) {\n  var nodes = toWrap instanceof Array ? toWrap : [toWrap];\n\n  // Note that we have to clone dataAttrs or several notes might end up\n  // sharing the same dataset object.\n  var dataAttrs = dataAttrs ? _.clone(dataAttrs) : {};\n\n  var note = h(TAG + '.' + CLASS_NAME, {title: getEditedByTitleText(dataAttrs), dataset: dataAttrs}, nodes);\n  return note;\n}\n\nfunction unwrap(focus) {\n  var note = focus.vNode;\n  var noteContents = note.children;\n  var indexOfNode = focus.parent.vNode.children.indexOf(note);\n\n  // Do the unwrapping.\n  focus.parent.vNode.children.splice(indexOfNode, 1, noteContents); // replace note\n  focus.parent.vNode.children = _.flatten(focus.parent.vNode.children);\n\n  // We want the note contents to now have their grandparent as parent.\n  // The safest way we can ensure this is by changing the VFocus object\n  // that previously focused on the note to instead focus on its parent.\n  focus.vNode = focus.parent.vNode;\n  focus.parent = focus.parent.parent;\n}\n\nfunction addUniqueVNodeClass(vNode, name) {\n  var classes = vNode.properties.className.split(' ');\n  classes.push(name);\n\n  vNode.properties.className = _.uniq(classes).join(' ');\n}\n\nfunction removeVNodeClass(vNode, name) {\n  var classes = vNode.properties.className.split(' ');\n  var classId = classes.indexOf(name);\n\n  if (classId !== -1) {\n    classes.splice(classId, 1);\n    vNode.properties.className = classes.join(' ');\n  }\n}\n\nfunction generateUUID(){\n  /* jshint bitwise:false */\n  var d = new Date().getTime();\n  var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n      var r = (d + Math.random()*16)%16 | 0;\n      d = Math.floor(d/16);\n      return (c=='x' ? r : (r&0x7|0x8)).toString(16);\n  });\n  return uuid;\n};\n\n// Update note properties, adding them if they aren't already there.\n// Note that this is also a way of merging notes, as we update the\n// start and end classes as well as give the segments the same edited\n// by information.\nfunction updateNoteProperties(noteSegments) {\n  updateStartAndEndClasses(noteSegments);\n\n  // FIXME JP 20/11/14\n  // This is a bug with users not being updated on the right note\n  // noteSegments.forEach(updateEditedBy);\n\n  var uuid = generateUUID();\n  noteSegments.forEach(function (segment) {\n    segment.vNode.properties.dataset['noteId'] = uuid;\n  });\n\n}\n\n// Ensure the first (and only the first) note segment has a\n// `note--start` class and that the last (and only the last)\n// note segment has a `note--end` class.\nfunction updateStartAndEndClasses(noteSegments) {\n  function addStartAndEndClasses(noteSegments) {\n    addUniqueVNodeClass(noteSegments[0].vNode, 'note--start');\n    addUniqueVNodeClass(noteSegments[noteSegments.length - 1].vNode, 'note--end');\n  }\n\n  function removeStartAndEndClasses(noteSegments) {\n    noteSegments.forEach(function(segment) {\n      removeVNodeClass(segment.vNode, 'note--start');\n      removeVNodeClass(segment.vNode, 'note--end');\n    });\n  }\n\n  removeStartAndEndClasses(noteSegments);\n  addStartAndEndClasses(noteSegments);\n}\n\nfunction getEditedByTitleText(dataAttrs) {\n  var date = new Date(dataAttrs[DATA_DATE_CAMEL]),\n\n  // crude formatting avoids a \"momentjs\" dependency - should be adequate\n  // forced UK formatted time in local timezone:  dd/MM/YYYY at hh:mm\n  formattedDate = [\n    date.getDate() + '/' + (date.getMonth() + 1) + '/' + date.getFullYear(),\n    'at',\n    date.getHours() + ':' + (date.getMinutes() < 9 ? '0' : '') + date.getMinutes()\n  ].join(' ');\n\n  return dataAttrs[DATA_NAME_CAMEL] + '  ' + formattedDate;\n}\n\nfunction updateEditedBy(noteSegment) {\n  var dataset = userAndTimeAsDatasetAttrs();\n\n  noteSegment.vNode.properties.dataset[DATA_NAME_CAMEL] = dataset[DATA_NAME_CAMEL];\n  noteSegment.vNode.properties.dataset[DATA_DATE_CAMEL] = dataset[DATA_DATE_CAMEL];\n\n  noteSegment.vNode.properties.title = getEditedByTitleText(dataset);\n}\n\nfunction userAndTimeAsDatasetAttrs() {\n  var dataset = {};\n  dataset[DATA_NAME_CAMEL] = exports.user;\n  dataset[DATA_DATE_CAMEL] = new Date().toISOString();\n\n  return dataset;\n}\n\nfunction createVirtualScribeMarker() {\n  return h('em.scribe-marker', []);\n}\n\n// We need these to make it possible to place the caret immediately\n// inside/outside of a note.\nfunction createNoteBarrier() {\n  return new VText('\\u200B');\n}\n\nfunction updateNoteBarriers(treeFocus) {\n  function removeNoteBarriers(treeFocus) {\n    treeFocus.filter(vdom.focusOnTextNode).forEach(function (focus) {\n      focus.vNode.text = focus.vNode.text.replace(/\\u200B/g, '');\n    });\n  }\n\n  function insertNoteBarriers(treeFocus) {\n    vdom.findAllNotes(treeFocus).forEach(function (noteSegments) {\n\n      _.first(noteSegments).next().insertBefore(createNoteBarrier());\n      // This is necessarily complex (been through a few iterations) because\n      // of Chrome's lack of flexibility when it comes to placing the caret.\n      var afterNote = _.last(noteSegments).find(vdom.focusOutsideNote);\n      var textNodeAfterNoteFocus = afterNote && afterNote.find(vdom.focusOnNonEmptyTextNode);\n\n      if (textNodeAfterNoteFocus) {\n        textNodeAfterNoteFocus.vNode.text = '\\u200B' + textNodeAfterNoteFocus.vNode.text;\n      }\n\n    });\n  }\n\n  removeNoteBarriers(treeFocus);\n  insertNoteBarriers(treeFocus);\n}\n\n\n// tree - tree containing a marker.\n// Note that we will mutate the tree.\nfunction createEmptyNoteAtCaret(treeFocus) {\n  // We need a zero width space character to make the note selectable.\n  var zeroWidthSpace = '\\u200B';\n\n  // To make sure the caret is placed within the note we place a scribe\n  // maker within it.\n  // Chrome is picky about needing the space to be before the marker\n  // (otherwise the caret won't be placed within the note).\n  var replacementVNode = wrapInNote([zeroWidthSpace, createVirtualScribeMarker()], userAndTimeAsDatasetAttrs());\n\n  // We assume there's only one marker.\n  var marker = vdom.findMarkers(treeFocus)[0];\n  marker.replace(replacementVNode);\n\n  var noteSegments = vdom.findEntireNote(marker);\n  updateNoteProperties(noteSegments);\n}\n\n// treeFocus: tree focus of tree containing two scribe markers\n// Note that we will mutate the tree.\nfunction createNoteFromSelection(treeFocus) {\n  // We want to wrap text nodes between the markers. We filter out nodes that have\n  // already been wrapped.\n  var toWrapAndReplace = vdom.findTextNodeFocusesBetweenMarkers(treeFocus).filter(vdom.focusOutsideNote);\n\n\n  // Wrap the text nodes.\n  var userAndTime = userAndTimeAsDatasetAttrs();\n  var wrappedTextNodes = toWrapAndReplace.map(function (focus) {\n    return wrapInNote(focus.vNode, userAndTime);\n  });\n\n\n  // Replace the nodes in the tree with the wrapped versions.\n  _.zip(toWrapAndReplace, wrappedTextNodes).forEach(function(focusAndReplacementVNode) {\n    var focus = focusAndReplacementVNode[0];\n    var replacementVNode = focusAndReplacementVNode[1];\n\n    focus.replace(replacementVNode);\n  });\n\n\n  // If we end up with an empty note a <BR> tag would be created. We have to do\n  // this before we remove the markers.\n  preventBrTags(treeFocus);\n\n\n  // We want to place the caret after the note. First we have to remove the\n  // existing markers.\n  vdom.removeVirtualScribeMarkers(treeFocus);\n\n\n  // Update note properties (merges if necessary).\n  var lastNoteSegment = vdom.findLastNoteSegment(toWrapAndReplace[0]);\n\n  var noteSegments = vdom.findEntireNote(lastNoteSegment);\n  updateNoteProperties(noteSegments);\n\n\n  // Now let's place that caret.\n  var outsideNoteFocus = _.last(noteSegments).find(vdom.focusOutsideNote);\n\n  // We guard against the case when the user notes the last piece of text in a\n  // Scribe instance. In that case we don't bother placing the cursor.\n  // (What behaviour would a user expect?)\n  if (outsideNoteFocus) {\n    if (! vdom.focusOnParagraph(outsideNoteFocus)) {\n      // The user's selection ends within a paragraph.\n\n      // To place a marker we have to place an element inbetween the note barrier\n      // and the marker, or Chrome will place the caret inside the note.\n      outsideNoteFocus.insertBefore([new VText('\\u200B'), createVirtualScribeMarker()]);\n\n    } else {\n\n      // The user's selection ends with a whole paragraph being selected. Now\n      // we need to place the caret in a different manner (or we will end up\n      // with a new empty paragraph). So we place the caret at the start of the\n      // next paragraph.\n      var focus = outsideNoteFocus.find(vdom.focusOnNonEmptyTextNode);\n      if (focus) focus.insertBefore(createVirtualScribeMarker());\n    }\n  }\n\n  vdom.removeEmptyNotes(treeFocus);\n  exports.ensureNoteIntegrity(treeFocus);\n}\n\nfunction unnote(treeFocus) {\n  // We assume the caller knows there's only one marker.\n  var marker = vdom.findMarkers(treeFocus)[0];\n  // We can't use findEntireNote here since it'll sometimes give us the wrong result.\n  // See `findEntireNote` documentation. Instead we look the note up by its ID.\n  vdom.updateNotesCache(treeFocus);\n  var noteSegment = vdom.findAncestorNoteSegment(marker);\n  var noteSegments = vdom.findNote(treeFocus, noteSegment.vNode.properties.dataset.noteId);\n\n  noteSegments.forEach(unwrap);\n\n  exports.ensureNoteIntegrity(treeFocus);\n\n  // The marker is where we want it to be (the same position) so we'll\n  // just leave it.\n}\n\n\n/*\nUnnote part of note, splitting the rest of the original note into new notes.\n\nExample\n-------\nText within a note has been selected:\n\n  <p>Asked me questions about the vessel<gu-note>|, the time she left Marseilles|, the\n  course she had taken,</gu-note> and what was her cargo. I believe, if she had not\n  been laden, and I had been her master, he would have bought her.</p>\n\n\nWe find the entire note and, within the note, we note everything _but_ what we want to unnote:\n\n  <p>Asked me questions about the vessel<gu-note>, the time she left Marseilles<gu-note>, the\n  course she had taken,</gu-note></gu-note> and what was her cargo. I believe, if she had not\n  been laden, and I had been her master, he would have bought her.</p>\n\n\nThen we unwrap the previously existing note. The text we selected has been unnoted:\n\n  <p>Asked me questions about the vessel, the time she left Marseilles<gu-note>, the\n  course she had taken,</gu-note> and what was her cargo. I believe, if she had not\n  been laden, and I had been her master, he would have bought her.</p>\n\n*/\nfunction unnotePartOfNote(treeFocus) {\n  function notToBeUnnoted(focus) {\n    var candidateVTextNode = focus.vNode;\n    return textNodesToUnnote.indexOf(candidateVTextNode) === -1;\n  }\n\n  var focusesToUnnote = vdom.findTextNodeFocusesBetweenMarkers(treeFocus);\n  var entireNote = vdom.findEntireNote(focusesToUnnote[0]);\n\n\n  var entireNoteTextNodeFocuses = _(entireNote).map(vdom.focusAndDescendants)\n    .flatten().value().filter(vdom.focusOnTextNode);\n\n  var entireNoteTextNodes = entireNoteTextNodeFocuses.map(function (focus) { return focus.vNode; });\n\n\n  var textNodesToUnnote = focusesToUnnote.map(function (focus) { return focus.vNode; });\n  var toWrapAndReplace = _.difference(entireNoteTextNodes, textNodesToUnnote);\n\n\n  var focusesToNote = entireNoteTextNodeFocuses.filter(notToBeUnnoted);\n  var userAndTime = userAndTimeAsDatasetAttrs();\n\n\n  // Wrap the text nodes.\n  var wrappedTextNodes = toWrapAndReplace.map(function (vNode) {\n    return wrapInNote(vNode, userAndTime);\n  });\n\n  // Replace the nodes in the tree with the wrapped versions.\n  _.zip(focusesToNote, wrappedTextNodes).forEach(function(focusAndReplacementVNode) {\n    var focus = focusAndReplacementVNode[0];\n    var replacementVNode = focusAndReplacementVNode[1];\n\n    focus.replace(replacementVNode);\n  });\n\n  // Unwrap previously existing note.\n  entireNote.forEach(unwrap);\n\n\n  // Unless the user selected the entire note contents, notes to the left\n  // and/or right of the selection will have been created. We need to update\n  // their attributes and CSS classes.\n  var onlyPartOfContentsSelected = focusesToNote[0];\n\n\n  if (onlyPartOfContentsSelected) {\n    var tf = focusesToNote[0].top();\n    exports.ensureNoteIntegrity(tf);\n  }\n\n  // Place marker immediately before the note to the right (this way of doing\n  // that seems to be the most reliable for some reason). Both Chrome and\n  // Firefox have issues with this however. To force them to behave we insert\n  // an empty span element inbetween.\n  var markers = vdom.findMarkers(treeFocus.refresh());\n  _.last(markers).insertAfter(new VText('\\u200B'));\n  markers[0].remove();\n\n\n  // If the user selected everything but a space (or zero width space), we remove\n  // the remaining note. Most likely that's what our user intended.\n  vdom.removeEmptyNotes(treeFocus.refresh());\n\n}\n\n\n/*\n  Example. We have two notes:\n  <p>\n    <gu-note>Some noted text</gu-note>| and some other text inbetween |<gu-note>More noted text</gu-note>\n  </p>\n\n  We press BACKSPACE, deleting the text, and end up with:\n  <p>\n    <gu-note data-note-edited-by=\"Edmond Dants\" data-note-edited-date=\"2014-09-15T16:49:20.012Z\">Some noted text</gu-note><gu-note data-note-edited-by=\"Lord Wilmore\" data-note-edited-date=\"2014-09-20T10:00:00.012Z\">More noted text</gu-note>\n  </p>\n\n  This function will merge the notes:\n  <p>\n    <gu-note data-note-edited-by=\"The Count of Monte Cristo\" data-note-edited-date=\"2014-10-10T17:00:00.012Z\">Some noted text</gu-note><gu-note data-note-edited-by=\"The Count of Monte Cristo\" data-note-edited-date=\"2014-10-10T17:00:00.012Z\">More noted text</gu-note>\n  </p>\n\n  The last user to edit \"wins\", the rationale being that they have approved\n  these notes by merging them. In this case all note segments are now\n  listed as being edited by The Count of Monte Cristo and the timestamp\n  shows the time when the notes were merged.\n */\n\nfunction mergeIfNecessary(treeFocus) {\n\n  function inconsistentTimestamps(note) {\n    function getDataDate(noteSegment) {\n      return noteSegment.vNode.properties.dataset[DATA_DATE_CAMEL];\n    }\n\n    var uniqVals = _(note).map(getDataDate).uniq().value();\n    return uniqVals.length > 1;\n  }\n\n  function lacksStartOrEnd(note) {\n    var hasNoteStart = 'noteStart' in note[0].vNode.properties.dataset;\n    var hasNoteEnd = 'noteEnd' in note[note.length - 1].vNode.properties.dataset;\n\n    return ! (hasNoteStart && hasNoteEnd);\n  }\n\n  // Merging is simply a matter of updating the attributes of any notes\n  // where all the segments of the note doesn't have the same timestamp,\n  // or where there's no start or end property (e.g. when the user has deleted\n  // the last note segment of a note).\n  function criteria(note) { return inconsistentTimestamps(note) || lacksStartOrEnd(note); }\n  vdom.findAllNotes(treeFocus).filter(criteria).forEach(updateNoteProperties);\n}\n\n\n// In a contenteditable, Scribe currently insert a <BR> tag into empty elements.\n// This causes styling issues when the user deletes a part of a note,\n// e.g. using backspace. This function provides a workaround and should be run\n// anytime a note segment might be empty (as defined by `vdom.consideredEmpty`).\n// TODO: Fix this in Scribe.\nfunction preventBrTags(treeFocus) {\n  function isTrue(obj) { return !!obj; }\n\n  function removeEmptyAncestors(focus) {\n    var f = focus;\n    while (f) {\n      if (! f.canDown()) f.remove();\n      f = f.up();\n    }\n  }\n\n  // When we delete a space we want to add a space to the previous\n  // note segment.\n  function addSpaceToPrevSegment(segment) {\n      var prevNoteSegment = segment.prev().find(vdom.focusOnNote, 'prev');\n\n      if (prevNoteSegment) {\n        var lastTextNode = _.last(prevNoteSegment.vNode.children.filter(isVText));\n        if (lastTextNode) lastTextNode.text = lastTextNode.text + ' ';\n      }\n  }\n\n  // We're only interested in when content is removed, meaning\n  // there should only be one marker (a collapsed selection).\n  //\n  // Could possibly develop a way of knowing deletions from\n  // additions, but this isn't necessary at the moment.\n  var markers = vdom.findMarkers(treeFocus);\n  if (markers.length === 2) return;\n\n\n  // We're good to go.\n  var marker = markers[0];\n  if (!marker) return;\n  // Let's find any note segment before or after the marker.\n  var segments = [\n    marker.find(vdom.focusOnNote, 'prev'),\n    marker.find(vdom.focusOnNote)\n  ].filter(isTrue);\n\n  // Replace/delete empty notes, and parents that might have become empty.\n  segments.filter(function (segment) { return !!segment; })\n    .map(function (segment) {\n      if (vdom.withEmptyTextNode(segment)) addSpaceToPrevSegment(segment);\n\n      if (vdom.withoutText(segment) || vdom.withEmptyTextNode(segment)) {\n      // In Chrome, removing causes text before the note to be deleted when\n      // deleting the last note segment. Replacing with an empty node works\n      // fine in Chrome and FF.\n      var replaced = segment.replace(new VText('\\u200B'));\n\n      removeEmptyAncestors(replaced);\n    }\n  });\n}\n\n\nexports.ensureNoteIntegrity = function (treeFocus) {\n  // cache must be up to date before running this\n  vdom.updateNotesCache(treeFocus);\n  mergeIfNecessary(treeFocus);\n  updateNoteBarriers(treeFocus);\n  preventBrTags(treeFocus);\n};\n\n\nexports.toggleNoteAtSelection = function toggleNoteAtSelection(treeFocus, selection) {\n  function state() {\n    var selectionMarkers = vdom.findMarkers(treeFocus);\n    var selectionIsCollapsed = selectionMarkers.length === 1;\n    var withinNote = vdom.selectionEntirelyWithinNote(selectionMarkers);\n\n    var state;\n    if (selectionIsCollapsed && withinNote) {\n      state = 'caretWithinNote';\n    } else if (withinNote) {\n      state = 'selectionWithinNote';\n    } else if (selectionIsCollapsed) {\n      state = 'caretOutsideNote';\n    } else {\n      state = 'selectionOutsideNote'; // at least partially outside.\n    }\n\n    return state;\n  }\n\n  var scenarios = {\n    caretWithinNote: function (treeFocus) { unnote(treeFocus); },\n    selectionWithinNote: function (treeFocus) {  unnotePartOfNote(treeFocus); },\n    caretOutsideNote: function (treeFocus) { createEmptyNoteAtCaret(treeFocus); },\n    selectionOutsideNote: function (treeFocus) { createNoteFromSelection(treeFocus); }\n  };\n\n  // Perform action depending on which state we're in.\n  scenarios[state()](treeFocus);\n};\n\n// TODO: Replace with `selectionEntirelyWithinNote`.\nexports.isSelectionInANote = function isSelectionInANote(selectionRange, parentContainer) {\n\n  // Walk up the (real) DOM checking isTargetNode.\n  function domWalkUpFind(node, isTargetNode) {\n    if (!node.parentNode || node === parentContainer) { return false; }\n\n    return isTargetNode(node) ? node : domWalkUpFind(node.parentNode, isTargetNode);\n  }\n\n  // Return the note our selection is inside of, if we are inside one.\n  function domFindAncestorNote(node) {\n    return domWalkUpFind(node, function(node) {\n      return node.tagName === NODE_NAME;\n    });\n  }\n\n  return domFindAncestorNote(selectionRange.startContainer) && domFindAncestorNote(selectionRange.endContainer) && true;\n};\n\n},{\"./note-vdom\":57,\"lodash\":\"lodash\",\"virtual-hyperscript\":23,\"vtree/is-vtext\":47,\"vtree/vtext\":53}],57:[function(require,module,exports){\n/**\n * Shared note vdom functions.\n */\n\n'use strict';\n\nvar isVText = require('vtree/is-vtext');\n\nvar NODE_NAME = 'GU-NOTE';\nvar TAG = 'gu-note';\nvar NOTE_BARRIER_TAG = 'gu-note-barrier';\nvar _ = require('lodash');\n\n\n// cache the notes and update them when new notes are added\n// caching the existing notes prevent needless tree traversal,\n// which have O(n) complexity.\nvar notesCache;\n/**\n* Noting: Checks\n*/\n\nfunction focusOnMarker(focus) {\n  return isScribeMarker(focus.vNode);\n}\n\nfunction focusNotOnMarker(focus) {\n  return ! focusOnMarker(focus);\n}\n\nfunction focusOnTextNode (focus) {\n  return focus.vNode.type === 'VirtualText';\n}\n\nfunction focusOnNote(focus) {\n  return isNote(focus.vNode);\n}\n\nfunction focusOutsideNote(focus) {\n  return ! findAncestorNoteSegment(focus);\n}\n\nfunction consideredEmpty(s) {\n  var zeroWidthSpace = '\\u200B';\n  var nonBreakingSpace = '\\u00a0';\n\n  // We incude regular spaces because if we have a note tag that only\n  // includes a a regular space, then the browser will also insert a <BR>.\n  // If we consider a string containing only a regular space as empty we\n  // can remove the note tag to avoid the line break.\n  //\n  // Not ideal since it causes the space to be deleted even though the user\n  // hasn't asked for that. We compensate for this by moving any deleted\n  // space to the previous note segment.\n  var regularSpace = ' ';\n\n  return s === '' || s === zeroWidthSpace || s === nonBreakingSpace || s === regularSpace;\n}\n\nfunction focusOnEmptyTextNode(focus) {\n  var vNode = focus.vNode;\n  return isVText(vNode) && consideredEmpty(vNode.text);\n}\n\nfunction focusOnNonEmptyTextNode(focus) {\n  return focusOnTextNode(focus) && !focusOnEmptyTextNode(focus);\n}\n\nfunction focusOnParagraph(focus) {\n    return focus.vNode.tagName && focus.vNode.tagName.toLowerCase() === 'p';\n  }\n\n// Whether a DOM node or vNode is a note.\n// Case insensitive to work with both DOM nodes and vNodes\n// (which can be lowercase).\nfunction isNote(node) {\n  return node.tagName && node.tagName.toLowerCase() === TAG;\n}\n\nfunction isScribeMarker(vNode) {\n  return hasClass(vNode, 'scribe-marker');\n};\n\n// Check if VNode has class\n// TODO: Currently not working on nodes with multiple classes (not an\n// issue at the moment).\nfunction hasClass(vNode, value) {\n  return (vNode.properties && vNode.properties.className === value);\n}\n\nfunction hasNoteId(vNode, value) {\n  return !!(vNode.properties && vNode.properties.dataset &&\n    vNode.properties.dataset.noteId === value);\n}\n\nfunction stillWithinNote(focus) {\n  return !focusOnTextNode(focus) || focusOnEmptyTextNode(focus) || findAncestorNoteSegment(focus);\n}\n\n\n/**\n* Noting: Finders and filters\n*/\n\nfunction findAncestorNoteSegment(focus) {\n  return focus.find(focusOnNote, 'up');\n}\n\nfunction findTextNodeFocusesBetweenMarkers(treeFocus) {\n  return focusOnlyTextNodes(\n    treeFocus.find(focusOnMarker).next().takeWhile(focusNotOnMarker)\n  );\n}\n\nfunction findMarkers(treeFocus) {\n  return treeFocus.filter(focusOnMarker);\n}\n\nfunction findFirstNoteSegment(noteSegment) {\n  return _.last(\n    noteSegment.takeWhile(stillWithinNote, 'prev').filter(focusOnNote)\n  );\n}\n\nfunction findLastNoteSegment(noteSegment) {\n  return _.last(\n    noteSegment.takeWhile(stillWithinNote).filter(focusOnNote)\n  );\n}\n\n\nfunction focusAndDescendants(focus) {\n  // TODO: Use a proper algorithm for this.\n  function insideTag(insideOfFocus) {\n    return !!insideOfFocus.find(function (f) { return f.vNode === focus.vNode; }, 'up');\n  }\n  return focus.takeWhile(insideTag);\n}\n\nfunction withoutText(focus) {\n  return focusAndDescendants(focus).filter(focusOnTextNode).length === 0;\n}\n\nfunction withEmptyTextNode(focus) {\n  return focusAndDescendants(focus).filter(focusOnTextNode).every(focusOnEmptyTextNode);\n}\n\n// Find the rest of a note.\n// We identify notes based on 'adjacency' rather than giving them an id.\n// This is because people may press RETURN or copy and paste part of a note.\n// In such cases we don't want that to keep being the same note.\n//\n// This has a caveat when:\n// 1. A note covers 3 paragraphs.\n// 2. Part of a note in paragraph 2 is unnoted.\n// 3. The caret is placed in paragraph 3.\n// 4. The noting key is pressed.\n// findFirstNoteSegment will then move backwards over a P\n// and into the first note. We will then unnote the first\n// note rather than the second.\n//\n// noteSegment: focus on note\nfunction findEntireNote(noteSegment) {\n  return findFirstNoteSegment(noteSegment)\n    .takeWhile(stillWithinNote).filter(focusOnNote);\n};\n\n// Find a note based on its ID. Will not always give the same result as `findEntireNote` ,\n// since that'll recognize that a note is adjacent to another one. But when a note\n// covers several paragraphs we can't be sure findEntireNote\n// will give us the right result (see comment for findEntireNote).\n//\n// TODO: Redo findEntireNote to be based on findNote and IDs? Could perhaps\n// find adjacent notes with the help of focus.prev() and focus.next().\nfunction findNote(treeFocus, noteId) {\n  var allNoteSegments = _.flatten(findAllNotes(treeFocus));\n\n  return allNoteSegments.filter(function (segment) {\n    return hasNoteId(segment.vNode, noteId);\n  });\n};\n\n// Returns an array of arrays of note segments\n\n\nfunction findAllNotes(treeFocus) {\n\n    if (!notesCache || notesCache.length === 0) {\n        notesCache = getAllNotes(treeFocus);\n    }\n\n    return notesCache;\n}\n\nfunction getAllNotes(treeFocus) {\n    return treeFocus.filter(focusOnNote).map(findEntireNote).reduce(function(uniqueNotes, note) {\n        // First iteration: Add the note.\n    if (uniqueNotes.length === 0) return uniqueNotes.concat([note]);\n\n        // Subsequent iterations: Add the note if it hasn't already been added.\n        return _.last(uniqueNotes)[0].vNode === note[0].vNode ? uniqueNotes : uniqueNotes.concat([note]);\n        }, []);\n}\n\nfunction updateNotesCache(treeFocus) {\n    notesCache = getAllNotes(treeFocus);\n}\n\nfunction focusOnlyTextNodes (focuses) {\n  return focuses.filter(focusOnTextNode);\n}\n\n\nfunction findSelectedNote(treeFocus) {\n  var note = findAncestorNoteSegment(findMarkers(treeFocus)[0]);\n\n  return note && findEntireNote(note) || undefined;\n};\n\n\nfunction selectionEntirelyWithinNote(markers) {\n  if (markers.length === 2) {\n    // We need the focusOnTextNode filter so we don't include P tags that\n    // contains notes for example.\n    var betweenMarkers = markers[0].next().takeWhile(focusNotOnMarker)\n      .filter(focusOnTextNode);\n\n    return betweenMarkers.every(findAncestorNoteSegment);\n  } else {\n    return !!findAncestorNoteSegment(markers[0]);\n  }\n}\n\n\n/**\n* Noting: Various\n*/\n\nfunction removeVirtualScribeMarkers(treeFocus) {\n  treeFocus.filter(focusOnMarker).forEach(function (marker) {\n    marker.remove();\n  });\n}\n\nfunction removeEmptyNotes(treeFocus) {\n  var allNoteSegments = _.flatten(findAllNotes(treeFocus));\n  var noteSegmentsWithDescendants = allNoteSegments.map(focusAndDescendants);\n\n  noteSegmentsWithDescendants.forEach(function (segmentWithDescendants) {\n    var segment = segmentWithDescendants[0];\n    var descendants = _.rest(segmentWithDescendants);\n\n    var hasOnlyEmptyTextNodes = descendants.filter(focusOnTextNode)\n      .every(focusOnEmptyTextNode);\n\n    if (segment.vNode.children.length === 0 || hasOnlyEmptyTextNodes) {\n      segment.remove();\n    }\n  });\n}\n\n\n// Export the following functions\n//   TODO: streamline these so that dependant modules use more generic functions\nexports.focusAndDescendants = focusAndDescendants;\nexports.focusOnEmptyTextNode = focusOnEmptyTextNode;\nexports.focusOnNonEmptyTextNode = focusOnNonEmptyTextNode;\nexports.focusOnMarker = focusOnMarker;\nexports.focusOnNote = focusOnNote;\nexports.focusOnParagraph = focusOnParagraph;\nexports.focusOnTextNode = focusOnTextNode;\nexports.withoutText = withoutText;\nexports.withEmptyTextNode = withEmptyTextNode;\nexports.findLastNoteSegment = findLastNoteSegment;\nexports.focusOutsideNote = focusOutsideNote;\nexports.findSelectedNote = findSelectedNote;\nexports.findAllNotes = findAllNotes;\nexports.findEntireNote = findEntireNote;\nexports.findNote = findNote;\nexports.findFirstNoteSegment = findFirstNoteSegment;\nexports.findMarkers = findMarkers;\nexports.isScribeMarker = isScribeMarker;\nexports.findAncestorNoteSegment = findAncestorNoteSegment;\nexports.findTextNodeFocusesBetweenMarkers = findTextNodeFocusesBetweenMarkers;\nexports.removeEmptyNotes = removeEmptyNotes;\nexports.removeVirtualScribeMarkers = removeVirtualScribeMarkers;\nexports.selectionEntirelyWithinNote = selectionEntirelyWithinNote;\nexports.updateNotesCache = updateNotesCache;\n\n},{\"lodash\":\"lodash\",\"vtree/is-vtext\":47}],58:[function(require,module,exports){\n/**\n * Noting commands\n *\n * Scribe noting commands.\n */\n\n'use strict';\n\nvar noteToggle = require('./api/note-toggle');\nvar noteCollapse = require('./api/note-collapse');\nvar vdom = require('./noting-vdom');\nvar _ = require('lodash');\n\n\n/**\n * Initialise noting commands\n * @param  {Scribe} scribe\n * @param  {String} user  Current user string.\n */\nexports.init = function(scribe, config) {\n  // initialise current user for Noting API\n  noteToggle.user = config.user;\n\n  // initialise scribe element selector\n  // TODO: Extract the configuration varialbles into its own module.\n  noteCollapse.scribeInstancesSelector = config.scribeInstancesSelector;\n\n  scribe.commands.note = createNoteToggleCommand(scribe);\n  scribe.commands.noteCollapseToggle = createCollapseToggleCommand(scribe);\n  scribe.commands.noteCollapseToggleAll = createCollapseToggleAllCommand(scribe);\n\n  addNoteToggleListener(scribe);\n  addNoteCollapseListener(scribe);\n\n  addContentChangedListener(scribe);\n};\n\n\nfunction createNoteToggleCommand(scribe) {\n  var noteCommand = new scribe.api.Command('insertHTML');\n\n  noteCommand.execute = function() {\n\n    vdom.mutateScribe(scribe, function(treeFocus, selection) {\n      noteToggle.toggleNoteAtSelection(treeFocus, selection);\n    });\n\n  };\n\n  noteCommand.queryState = function() {\n    var selection = new scribe.api.Selection();\n\n    return noteToggle.isSelectionInANote(selection.range, scribe.el);\n  };\n\n  noteCommand.queryEnabled = function() {\n    return true;\n  };\n\n  return noteCommand;\n}\n\n\n\n\nfunction createCollapseToggleCommand(scribe) {\n  var collapseCommand = new scribe.api.Command('insertHTML');\n\n  // *** collapse toggle command ***\n  collapseCommand.execute = function(value) {\n\n    vdom.mutateScribe(scribe, function(treeFocus) {\n      noteCollapse.collapseToggleSelectedNote(treeFocus);\n    });\n\n  };\n\n  collapseCommand.queryState = function() {\n\n  };\n\n  return collapseCommand;\n}\n\n\nfunction createCollapseToggleAllCommand(scribe) {\n  var collapseAllCommand = new scribe.api.Command('insertHTML');\n\n  // *** toggle collapse all command ***\n  collapseAllCommand.execute = function() {\n    // This command is a bit special in the sense that it will operate on all\n    // Scribe instances on the page.\n    //\n    // We use a global variable to keep track of the state since we need this\n    // to be available to all Scribe instances. Otherwise the state in different\n    // instances can get out of sync.\n    var state = !window._scribe_plugin_noting__noteCollapsedState,\n        scribeInstances = _.toArray(document.querySelectorAll(noteCollapse.scribeInstancesSelector));\n\n    scribeInstances.forEach(function (instance) {\n\n      vdom.mutate(instance, function(treeFocus) {\n        noteCollapse.collapseToggleAllNotes(treeFocus, state);\n      });\n\n    });\n\n    window._scribe_plugin_noting__noteCollapsedState = state;\n  };\n\n  collapseAllCommand.queryEnabled = function() {\n    // true when notes are on page\n    return !!scribe.el.getElementsByTagName('gu-note').length;\n  };\n\n  collapseAllCommand.queryState = function() {\n    return this.queryEnabled() && !!window._scribe_plugin_noting__noteCollapsedState;\n  };\n\n  return collapseAllCommand;\n\n}\n\n\nfunction addNoteToggleListener(scribe) {\n  scribe.el.addEventListener('keydown', function (event) {\n    var f8 = event.keyCode === 119;\n    var f10 = event.keyCode === 121;\n    var altBackspace = event.altKey && event.keyCode === 8;\n\n    if (f8 || f10 || altBackspace) {\n      event.preventDefault();\n      scribe.getCommand('note').execute();\n    }\n  });\n}\n\n\nfunction addNoteCollapseListener(scribe) {\n  scribe.el.addEventListener('click', function(event) {\n    var target = event.target;\n\n    if (target.nodeName == 'GU-NOTE') {\n\n      var selection = new scribe.api.Selection();\n\n      var range = document.createRange();\n      range.selectNodeContents(target);\n\n      selection.selection.removeAllRanges();\n      selection.selection.addRange(range);\n\n      scribe.getCommand('noteCollapseToggle').execute();\n    }\n  });\n}\n\n\nfunction addContentChangedListener(scribe) {\n    function mutateScribe() {\n        vdom.mutateScribe(scribe, function(treeFocus) {\n            noteToggle.ensureNoteIntegrity(treeFocus);\n        });\n    }\n\n    var throttled = _.throttle(mutateScribe, 1000);\n\n    scribe.el.addEventListener('input', throttled);\n}\n\n},{\"./api/note-collapse\":55,\"./api/note-toggle\":56,\"./noting-vdom\":59,\"lodash\":\"lodash\"}],59:[function(require,module,exports){\n/**\n * Virtual DOM parser / serializer for Noting plugin.\n */\n\nvar TAG = 'gu-note';\n\nvar _ = require('lodash');\n\nvar diff = require('virtual-dom/diff');\nvar patch = require('virtual-dom/patch');\n\n// There was a bug in vdom-virtualize that caused data attributes not\n// to be virtualized. Have fixed this and got it merged upstream.\n// No new release yet, however, so have specified the specific commit as\n// dependency. Feel free to update to future versions when they're released.\nvar virtualize = require('vdom-virtualize');\n\nvar isVText = require('vtree/is-vtext');\n\nvar VFocus = require('./vfocus');\n\n\n/**\n * Virtualises a DOMElement to a callback for mutation.\n * @param  {DOMElement}   domElement\n * @param  {Function} callback\n */\nexports.mutate = function(domElement, callback) {\n\n  var originalTree = virtualize(domElement);\n  var tree = virtualize(domElement); // we'll mutate this one\n  var treeFocus = new VFocus(tree);\n\n  callback(treeFocus);\n\n  // Then diff with the original tree and patch the DOM.\n  var patches = diff(originalTree, tree);\n  patch(domElement, patches);\n\n};\n\nexports.mutateScribe = function(scribe, callback) {\n  var selection = new scribe.api.Selection();\n\n  scribe.transactionManager.run(function () {\n    // Place markers and create virtual trees.\n    // We'll use the markers to determine where a selection starts and ends.\n    selection.placeMarkers();\n\n    exports.mutate(scribe.el, function(treeFocus) {\n\n      callback(treeFocus, selection);\n\n    });\n\n    // Place caret (necessary to do this explicitly for FF).\n    // Currently works by selecting before and after real DOM elements, so\n    // cannot use VDOM for this, yet.\n    selection.selectMarkers();\n\n    // We need to make sure we clean up after ourselves by removing markers\n    // when we're done, as our functions assume there's either one or two\n    // markers present.\n    selection.removeMarkers();\n  });\n};\n\n},{\"./vfocus\":60,\"lodash\":\"lodash\",\"vdom-virtualize\":2,\"virtual-dom/diff\":9,\"virtual-dom/patch\":19,\"vtree/is-vtext\":47}],60:[function(require,module,exports){\n/**\n* VFocus: Wrap virtual node in a Focus node.\n*\n* Makes it possible to move around as you wish in the tree.\n*\n* vNode: the vNode to focus on\n* parent: parent vFocus\n*/\n\nmodule.exports = VFocus;\n\n\nfunction VFocus(vNode, parent) {\n  // Don't change these references pretty please\n  this.vNode = vNode;\n  this.parent = parent;\n};\n\n/**\n* Internally useful\n*/\n\nVFocus.prototype.rightVNode = function() {\n  if (this.isRoot()) return null;\n\n  var rightVNodeIndex = this.parent.vNode.children.indexOf(this.vNode) + 1;\n  return this.parent.vNode.children[rightVNodeIndex];\n};\n\nVFocus.prototype.leftVNode = function() {\n  if (this.isRoot()) return null;\n\n  var leftVNodeIndex = this.parent.vNode.children.indexOf(this.vNode) - 1;\n  return leftVNodeIndex >= 0 ? this.parent.vNode.children[leftVNodeIndex] : null;\n};\n\n\n/**\n* Checks\n*/\n\nVFocus.prototype.isRoot = function() {\n  return ! this.parent;\n};\n\nVFocus.prototype.canRight = function() {\n  return !!this.rightVNode();\n};\n\nVFocus.prototype.canLeft = function() {\n  return !!this.leftVNode();\n};\n\nVFocus.prototype.canDown = function() {\n  return this.vNode.children && this.vNode.children.length ? true : false;\n};\n\nVFocus.prototype.canUp = function() {\n  return ! this.isRoot();\n};\n\n\n/**\n* Movements\n*/\n\n// Focus next (pre-order)\nVFocus.prototype.next = function() {\n  function upThenRightWhenPossible(vFocus) {\n    // Terminate if we've visited all nodes.\n    if (!vFocus) return null;\n\n    return vFocus.right() || upThenRightWhenPossible(vFocus.up());\n  }\n\n  return this.down() || this.right() || upThenRightWhenPossible(this);\n};\n\n// Focus previous (pre-order)\nVFocus.prototype.prev = function() {\n  function downFurthestRight(vFocus) {\n    function furthestRight(vFocus) {\n      var focus = vFocus;\n      while (focus.canRight()) { focus = focus.right(); }\n      return focus;\n    }\n\n    return vFocus.canDown() ? downFurthestRight(vFocus.down()) : furthestRight(vFocus);\n  }\n\n  var focus;\n  if (this.left() && this.left().down()) {\n    focus = downFurthestRight(this.left());\n  } else if (this.left()) {\n    focus = this.left();\n  } else {\n    focus = this.up();\n  }\n\n  return focus;\n};\n\n// Focus first child\nVFocus.prototype.down = function() {\n  if (! this.canDown()) return null;\n\n  return new VFocus(this.vNode.children[0], this);\n};\n\n// Focus parent\nVFocus.prototype.up = function() {\n  if (! this.canUp()) return null;\n\n  return this.parent;\n};\n\n// Focus node to the right (on the same level)\nVFocus.prototype.right = function() {\n  if (! this.canRight()) return null;\n\n  return new VFocus(this.rightVNode(), this.parent);\n};\n\n// Focus node to the left (on the same level)\nVFocus.prototype.left = function() {\n  if (! this.canLeft()) return null;\n\n  return new VFocus(this.leftVNode(), this.parent);\n};\n\nVFocus.prototype.top = function() {\n  return this.canUp() ? this.parent.top() : this;\n};\n\n\n/**\n* Mutating operations\n*/\n\n// Replace `this.vNode` and return `this` to enable chaining.\n// Note that this mutates the tree.\nVFocus.prototype.replace = function(replacementVNode) {\n  if (this.isRoot()) {\n    // Replace and focus on the replacement.\n    this.vNode = replacementVNode;\n  } else {\n    // Replace the object in the tree we're focusing on.\n    var vNodeIndex = this.parent.vNode.children.indexOf(this.vNode);\n    this.parent.vNode.children.splice(vNodeIndex, 1, replacementVNode);\n\n    // And focus on the replacement.\n    this.vNode = replacementVNode;\n  }\n\n  return this;\n};\n\n// Remove `this.vNode`, i.e. remove the reference from the tree.\nVFocus.prototype.remove = function() {\n  if (this.isRoot()) {\n    // No can do. Should maybe raise an exception.\n  } else {\n    var vNodeIndex = this.parent.vNode.children.indexOf(this.vNode);\n    this.parent.vNode.children.splice(vNodeIndex, 1);\n  }\n\n  return this;\n};\n\nVFocus.prototype.insertBefore = function(newVNodes) {\n  var newVNodes = newVNodes instanceof Array ? newVNodes : [newVNodes];\n\n  if (this.isRoot()) {\n    // No can do. Should maybe raise an exception.\n  } else {\n    var siblings = this.parent.vNode.children;\n    var vNodeIndex = siblings.indexOf(this.vNode);\n\n    // Insert before ourself.\n    newVNodes.reverse().forEach(function (vNode) {\n      siblings.splice(vNodeIndex, 0, vNode);\n    });\n  }\n\n  return this;\n};\n\nVFocus.prototype.insertAfter = function(newVNodes) {\n  var newVNodes = newVNodes instanceof Array ? newVNodes : [newVNodes];\n\n  if (this.isRoot()) {\n    // No can do. Should maybe raise an exception.\n  } else {\n    var siblings = this.parent.vNode.children;\n    var vNodeIndex = siblings.indexOf(this.vNode);\n\n    if (siblings.length === vNodeIndex + 1) {\n      // Last element of array\n      siblings = siblings.concat(newVNodes);\n    } else {\n      // Insert before the next sibling.\n      newVNodes.reverse().forEach(function (vNode) {\n        siblings.splice(vNodeIndex + 1, 0, vNode);\n      });\n    }\n  }\n\n  return this;\n};\n\n// If the tree has been mutated and parent/vNode references not been updated\n// a VFocus might not refer to its \"correct\" parent. This will update our\n// `this.parent` reference.\n//\n// Note: If you have to use this method you should probably figure out how\n// your mutating function can change parent references to correctly reflect\n// the tree you're focusing on.\nVFocus.prototype.refresh = function() {\n  var self = this;\n  function myself(focus) { return focus.vNode === self.vNode }\n\n  // Traverse the tree until we end up focusing on `this.vNode`.\n  var me = this.top().find(myself);\n\n  // Now we know who our parent is, so we update this object's parent\n  // reference.\n  this.parent = me.parent;\n\n  return this;\n};\n\n\n/**\n* Iteration methods\n*/\n\nVFocus.prototype.forEach = function(fn) {\n  var node = this;\n  while (node) {\n    fn(node);\n    node = node.next();\n  }\n};\n\n// Flatten `this` and all nodes after, returning a list\nVFocus.prototype.flatten = function(replacementVNode) {\n  var focuses = [];\n  this.forEach(function(focus) { focuses.push(focus); });\n\n  return focuses;\n};\n\n// Take while condition is true. Return list.\n// predicate: function that receives the current item\n//       and returns true/false.\nVFocus.prototype.takeWhile = function(predicate, movement) {\n  var movement = movement || 'next';\n\n  var focus = this;\n  var acc = [];\n  while (focus && predicate(focus)) {\n    acc.push(focus);\n    focus = focus[movement]();\n  }\n  return acc;\n};\n\nVFocus.prototype.filter = function(predicate, movement) {\n  var movement = movement || 'next';\n\n  var results = [];\n  this.forEach(function(focus) {\n    if (predicate(focus)) results.push(focus);\n  }, movement);\n\n  return results;\n};\n\n// Find focus satisfying predicate.\n// predicate: function that takes a focus and returns true/false.\n// movement: string name of one of the movement functions, e.g. 'up' or 'prev'.\n// If nothing is found null is returned (as we step off the tree).\nVFocus.prototype.find = function(predicate, movement) {\n  var movement = movement || 'next';\n  var focus = this;\n\n  while (focus) {\n    if (predicate(focus)) break;\n    focus = focus[movement]();\n  }\n\n  return focus;\n};\n\n},{}]},{},[54])(54)\n});"],"names":["e","exports","module","define","amd","n","window","global","self","scribePluginNoting","t","r","s","o","u","a","require","i","f","Error","code","l","call","length",1,2,"createVNode","domNode","key","nodeType","createFromElement","createFromTextNode","tNode","VText","nodeValue","el","tagName","namespace","namespaceURI","properties","getElementProperties","children","childNodes","push","VNode","obj","props","forEach","propName","styleProp","css","style","getPropertyValue","data","p","dataset","fromHTML","html","document","createElement","innerHTML","attrs","vtree/vnode","vtree/vtext",3,"isHook","hook","hasOwnProperty",4,"isVirtualNode","x","type","version","./version",5,"isWidget","w",6,7,"VirtualNode","this","noProperties","noChildren","String","undefined","hooks","count","descendants","hasWidgets","descendantHooks","property","isVHook","child","isVNode","destroy","prototype","./is-vhook","./is-vnode","./is-widget",8,"VirtualText","text",9,"diff","vtree/diff",10,"isObject",11,"applyProperties","node","previous","propValue","removeProperty","patchObject","previousValue","attrName","removeAttribute","getPrototype","replacer","k","value","attrValue","setAttribute","Object","getPrototypeOf","__proto__","constructor","is-object","vtree/is-vhook",12,"vnode","opts","doc","warn","handleThunk","init","isVText","createTextNode","createElementNS","childNode","appendChild","./apply-properties","global/document","vtree/handle-thunk","vtree/is-vnode","vtree/is-vtext","vtree/is-widget",13,"domIndex","rootNode","tree","indices","nodes","sort","ascending","recurse","rootIndex","indexInRange","vChildren","vChild","noChild","nextIndex","left","right","currentIndex","currentItem","minIndex","maxIndex","b",14,"topLevel","minDoc","doccy","min-document",15,"applyPatch","vpatch","renderOptions","vNode","patch","VPatch","REMOVE","removeNode","INSERT","insertNode","VTEXT","stringPatch","WIDGET","widgetPatch","VNODE","vNodePatch","ORDER","reorderChildren","PROPS","THUNK","replaceRoot","parentNode","removeChild","destroyWidget","newNode","render","leftVNode","vText","replaceData","replaceChild","widget","updateWidget","update","newWidget","bIndex","len","reverseIndex","reverse","move","insertOffset","insertBefore","removes","oldRoot","newRoot","console","log","./create-element","./update-widget","vtree/vpatch",16,"patches","patchRecursive","patchIndices","index","ownerDocument","nodeIndex","patchList","isArray","patchOp","Number","./dom-index","./patch-op","x-is-array",17,"id",18,"toString","nativeIsArray","Array",19,"vdom/patch",20,"DataSetHook","DataSet","propertyName","ds","substr","data-set",21,22,"SoftSetHook",23,"h","tag","isChildren","parseTag","softSetHook","keys","j","dataSetHook","evHook","addChild","c","isChild","UnexpectedVirtualElement","foreignObjectStr","JSON","stringify","foreignObject","parentVnodeStr","parentVnode","isVThunk","TypedError","message","./hooks/data-set-hook.js","./hooks/ev-hook.js","./hooks/soft-set-hook.js","./parse-tag.js","error/typed","vtree/is-thunk","vtree/vnode.js","vtree/vtext.js",24,"createHash","elem","attributes","hash","attr","name",25,"store","hashStore","createStore","Individual","./create-hash.js","individual","weakmap-shim/create-store",26,"root","defineProperty","configurable",27,"valueOf","identity","hiddenStore","./hidden-store.js",28,"apply","arguments","writable",29,"walk","isDate","isRegex","map","reduce","objectKeys","acc","camel","camelCase","str","replace","_","toUpperCase","xs","res","has",30,"template","string","args","slice","nargs","match","result",31,"extend","target","source",32,"createError","enumerable","options","errorName","camelize","_name","string-template","xtend/mutable",33,"isThunk",34,"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/is-vhook.js",35,"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/is-vnode.js",36,"isVirtualText",37,"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/is-widget.js",38,"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/version.js",39,"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/vnode.js",40,"/Users/hgibson/git/scribe-plugin-noting/node_modules/vdom-virtualize/node_modules/vtree/vtext.js",41,"noId","tagParts","split","classIdSplit","notClassId","test","classes","part","charAt","substring","className","join","toLowerCase",42,"thunks","appendPatch","destroyWidgets","propsPatch","diffProps","diffChildren","aKey","aValue","bValue","objectDiff","bKey","aChildren","bChildren","reorder","aLen","bLen","leftNode","rightNode","moves","thunkPatch","hasPatches","bKeys","keyIndex","aKeys","bMatch","aMatch","shuffle","freeIndex","moveIndex","hasMoves","freeChild","./handle-thunk","./is-thunk","./is-vtext","./vpatch",43,"renderedA","renderedB","renderThunk","thunk","renderedThunk",44,"/Users/hgibson/git/scribe-plugin-noting/node_modules/virtual-hyperscript/node_modules/vtree/is-thunk.js",45,46,47,"/Users/hgibson/git/scribe-plugin-noting/node_modules/virtual-hyperscript/node_modules/vtree/is-vtext.js",48,49,"/Users/hgibson/git/scribe-plugin-noting/node_modules/virtual-dom/node_modules/is-object/index.js",50,"/Users/hgibson/git/scribe-plugin-noting/node_modules/virtual-dom/node_modules/x-is-array/index.js",51,52,"VirtualPatch","NONE",53,54,"notingCommands","config","scribe","./src/noting-commands",55,"toggleClass","state","existingIdx","indexOf","splice","toggleNotes","note","NOTE_CLASS_COLLAPSED","vdom","collapseToggleSelectedNote","treeFocus","selectedNote","findSelectedNote","collapseToggleAllNotes","findAllNotes","notes","./note-vdom",56,"wrapInNote","toWrap","dataAttrs","clone","TAG","CLASS_NAME","title","getEditedByTitleText","unwrap","focus","noteContents","indexOfNode","parent","flatten","addUniqueVNodeClass","uniq","removeVNodeClass","classId","generateUUID","d","Date","getTime","uuid","Math","random","floor","updateNoteProperties","noteSegments","updateStartAndEndClasses","segment","addStartAndEndClasses","removeStartAndEndClasses","date","DATA_DATE_CAMEL","formattedDate","getDate","getMonth","getFullYear","getHours","getMinutes","DATA_NAME_CAMEL","userAndTimeAsDatasetAttrs","user","toISOString","createVirtualScribeMarker","createNoteBarrier","updateNoteBarriers","removeNoteBarriers","filter","focusOnTextNode","insertNoteBarriers","first","next","afterNote","last","find","focusOutsideNote","textNodeAfterNoteFocus","focusOnNonEmptyTextNode","createEmptyNoteAtCaret","zeroWidthSpace","replacementVNode","marker","findMarkers","findEntireNote","createNoteFromSelection","toWrapAndReplace","findTextNodeFocusesBetweenMarkers","userAndTime","wrappedTextNodes","zip","focusAndReplacementVNode","preventBrTags","removeVirtualScribeMarkers","lastNoteSegment","findLastNoteSegment","outsideNoteFocus","focusOnParagraph","removeEmptyNotes","ensureNoteIntegrity","unnote","updateNotesCache","noteSegment","findAncestorNoteSegment","findNote","noteId","unnotePartOfNote","notToBeUnnoted","candidateVTextNode","textNodesToUnnote","focusesToUnnote","entireNote","entireNoteTextNodeFocuses","focusAndDescendants","entireNoteTextNodes","difference","focusesToNote","onlyPartOfContentsSelected","tf","top","markers","refresh","insertAfter","remove","mergeIfNecessary","inconsistentTimestamps","getDataDate","uniqVals","lacksStartOrEnd","hasNoteStart","hasNoteEnd","criteria","isTrue","removeEmptyAncestors","canDown","up","addSpaceToPrevSegment","prevNoteSegment","prev","focusOnNote","lastTextNode","segments","withEmptyTextNode","withoutText","replaced","NODE_NAME","toggleNoteAtSelection","selectionMarkers","selectionIsCollapsed","withinNote","selectionEntirelyWithinNote","scenarios","caretWithinNote","selectionWithinNote","caretOutsideNote","selectionOutsideNote","isSelectionInANote","selectionRange","parentContainer","domWalkUpFind","isTargetNode","domFindAncestorNote","startContainer","endContainer","lodash","virtual-hyperscript",57,"focusOnMarker","isScribeMarker","focusNotOnMarker","isNote","consideredEmpty","nonBreakingSpace","regularSpace","focusOnEmptyTextNode","hasClass","hasNoteId","stillWithinNote","focusOnlyTextNodes","takeWhile","findFirstNoteSegment","insideTag","insideOfFocus","every","allNoteSegments","notesCache","getAllNotes","uniqueNotes","concat","focuses","betweenMarkers","noteSegmentsWithDescendants","segmentWithDescendants","rest","hasOnlyEmptyTextNodes",58,"createNoteToggleCommand","noteCommand","api","Command","execute","mutateScribe","selection","noteToggle","queryState","Selection","range","queryEnabled","createCollapseToggleCommand","collapseCommand","noteCollapse","createCollapseToggleAllCommand","collapseAllCommand","_scribe_plugin_noting__noteCollapsedState","scribeInstances","toArray","querySelectorAll","scribeInstancesSelector","instance","mutate","getElementsByTagName","addNoteToggleListener","addEventListener","event","f8","keyCode","f10","altBackspace","altKey","preventDefault","getCommand","addNoteCollapseListener","nodeName","createRange","selectNodeContents","removeAllRanges","addRange","addContentChangedListener","throttled","throttle","commands","noteCollapseToggle","noteCollapseToggleAll","./api/note-collapse","./api/note-toggle","./noting-vdom",59,"virtualize","VFocus","domElement","callback","originalTree","transactionManager","run","placeMarkers","selectMarkers","removeMarkers","./vfocus","vdom-virtualize","virtual-dom/diff","virtual-dom/patch",60,"rightVNode","isRoot","rightVNodeIndex","leftVNodeIndex","canRight","canLeft","canUp","upThenRightWhenPossible","vFocus","down","downFurthestRight","furthestRight","vNodeIndex","newVNodes","siblings","myself","me","fn","predicate","movement","results"]}